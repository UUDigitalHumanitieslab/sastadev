
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>treebankfunctions &#8212; SASTA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SASTA  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">treebankfunctions</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for treebankfunctions</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">various treebank functions</span>

<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span><span class="p">,</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">SDLOGGER</span>
<span class="kn">from</span> <span class="nn">stringfunctions</span> <span class="kn">import</span> <span class="n">allconsonants</span>
<span class="c1"># from lexicon import informlexiconpos, isa_namepart_uc, informlexicon, isa_namepart</span>
<span class="kn">import</span> <span class="nn">lexicon</span> <span class="k">as</span> <span class="nn">lex</span>
<span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">PARSE_FUNC</span>

<span class="kn">from</span> <span class="nn">sastatoken</span> <span class="kn">import</span> <span class="n">Token</span>
<span class="kn">from</span> <span class="nn">metadata</span> <span class="kn">import</span> <span class="n">Meta</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">AnyStr</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Match</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">from</span> <span class="nn">sastatypes</span> <span class="kn">import</span> <span class="n">FileName</span><span class="p">,</span> <span class="n">OptPhiTriple</span><span class="p">,</span> <span class="n">PhiTriple</span><span class="p">,</span> <span class="n">Position</span><span class="p">,</span> <span class="n">PositionMap</span><span class="p">,</span> <span class="n">PositionStr</span><span class="p">,</span> <span class="n">Span</span><span class="p">,</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">UttId</span>


<span class="k">class</span> <span class="nc">Metadata</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    contains 3 elements, each a string: type, name, value</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thetype</span><span class="p">,</span> <span class="n">thename</span><span class="p">,</span> <span class="n">thevalue</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">thetype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">thename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">thevalue</span>

    <span class="k">def</span> <span class="nf">md2PEP</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;##META </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">md2XMLElement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;meta&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>


<span class="n">min_sasta_length</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">sasta_short_length</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">space</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
<span class="n">vertbar</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span>
<span class="n">compoundsep</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span>

<span class="n">numberpattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;^[\d\.,]+$&#39;</span>
<span class="n">numberre</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">numberpattern</span><span class="p">)</span>

<span class="c1"># next 3 derived from the alpino dtd</span>
<span class="n">allrels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hdf&#39;</span><span class="p">,</span> <span class="s1">&#39;hd&#39;</span><span class="p">,</span> <span class="s1">&#39;cmp&#39;</span><span class="p">,</span> <span class="s1">&#39;sup&#39;</span><span class="p">,</span> <span class="s1">&#39;su&#39;</span><span class="p">,</span> <span class="s1">&#39;obj1&#39;</span><span class="p">,</span> <span class="s1">&#39;pobj1&#39;</span><span class="p">,</span> <span class="s1">&#39;obj2&#39;</span><span class="p">,</span> <span class="s1">&#39;se&#39;</span><span class="p">,</span> <span class="s1">&#39;pc&#39;</span><span class="p">,</span> <span class="s1">&#39;vc&#39;</span><span class="p">,</span> <span class="s1">&#39;svp&#39;</span><span class="p">,</span> <span class="s1">&#39;predc&#39;</span><span class="p">,</span> <span class="s1">&#39;ld&#39;</span><span class="p">,</span> <span class="s1">&#39;me&#39;</span><span class="p">,</span>
           <span class="s1">&#39;predm&#39;</span><span class="p">,</span> <span class="s1">&#39;obcomp&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="s1">&#39;det&#39;</span><span class="p">,</span> <span class="s1">&#39;app&#39;</span><span class="p">,</span> <span class="s1">&#39;whd&#39;</span><span class="p">,</span> <span class="s1">&#39;rhd&#39;</span><span class="p">,</span> <span class="s1">&#39;cnj&#39;</span><span class="p">,</span> <span class="s1">&#39;crd&#39;</span><span class="p">,</span> <span class="s1">&#39;nucl&#39;</span><span class="p">,</span> <span class="s1">&#39;sat&#39;</span><span class="p">,</span> <span class="s1">&#39;tag&#39;</span><span class="p">,</span> <span class="s1">&#39;dp&#39;</span><span class="p">,</span>
           <span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;mwp&#39;</span><span class="p">,</span> <span class="s1">&#39;dlink&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">]</span>

<span class="n">allcats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;smain&#39;</span><span class="p">,</span> <span class="s1">&#39;np&#39;</span><span class="p">,</span> <span class="s1">&#39;ppart&#39;</span><span class="p">,</span> <span class="s1">&#39;ppres&#39;</span><span class="p">,</span> <span class="s1">&#39;pp&#39;</span><span class="p">,</span> <span class="s1">&#39;ssub&#39;</span><span class="p">,</span> <span class="s1">&#39;inf&#39;</span><span class="p">,</span> <span class="s1">&#39;cp&#39;</span><span class="p">,</span> <span class="s1">&#39;du&#39;</span><span class="p">,</span> <span class="s1">&#39;ap&#39;</span><span class="p">,</span> <span class="s1">&#39;advp&#39;</span><span class="p">,</span> <span class="s1">&#39;ti&#39;</span><span class="p">,</span> <span class="s1">&#39;rel&#39;</span><span class="p">,</span> <span class="s1">&#39;whrel&#39;</span><span class="p">,</span>
           <span class="s1">&#39;whsub&#39;</span><span class="p">,</span> <span class="s1">&#39;conj&#39;</span><span class="p">,</span> <span class="s1">&#39;whq&#39;</span><span class="p">,</span> <span class="s1">&#39;oti&#39;</span><span class="p">,</span> <span class="s1">&#39;ahi&#39;</span><span class="p">,</span> <span class="s1">&#39;detp&#39;</span><span class="p">,</span> <span class="s1">&#39;sv1&#39;</span><span class="p">,</span> <span class="s1">&#39;svan&#39;</span><span class="p">,</span> <span class="s1">&#39;mwu&#39;</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;part&#39;</span><span class="p">]</span>

<span class="n">allpts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;let&#39;</span><span class="p">,</span> <span class="s1">&#39;spec&#39;</span><span class="p">,</span> <span class="s1">&#39;bw&#39;</span><span class="p">,</span> <span class="s1">&#39;vg&#39;</span><span class="p">,</span> <span class="s1">&#39;lid&#39;</span><span class="p">,</span> <span class="s1">&#39;vnw&#39;</span><span class="p">,</span> <span class="s1">&#39;tw&#39;</span><span class="p">,</span> <span class="s1">&#39;ww&#39;</span><span class="p">,</span> <span class="s1">&#39;adj&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;tsw&#39;</span><span class="p">,</span> <span class="s1">&#39;vz&#39;</span><span class="p">]</span>

<span class="n">openclasspts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bw&#39;</span><span class="p">,</span> <span class="s1">&#39;ww&#39;</span><span class="p">,</span> <span class="s1">&#39;adj&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">]</span>

<span class="n">clausecats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;smain&#39;</span><span class="p">,</span> <span class="s1">&#39;ssub&#39;</span><span class="p">,</span> <span class="s1">&#39;inf&#39;</span><span class="p">,</span> <span class="s1">&#39;cp&#39;</span><span class="p">,</span> <span class="s1">&#39;ti&#39;</span><span class="p">,</span> <span class="s1">&#39;rel&#39;</span><span class="p">,</span> <span class="s1">&#39;whrel&#39;</span><span class="p">,</span> <span class="s1">&#39;whsub&#39;</span><span class="p">,</span> <span class="s1">&#39;whq&#39;</span><span class="p">,</span> <span class="s1">&#39;oti&#39;</span><span class="p">,</span> <span class="s1">&#39;ahi&#39;</span><span class="p">,</span> <span class="s1">&#39;sv1&#39;</span><span class="p">,</span> <span class="s1">&#39;svan&#39;</span><span class="p">]</span>

<span class="n">trueclausecats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;smain&#39;</span><span class="p">,</span> <span class="s1">&#39;cp&#39;</span><span class="p">,</span> <span class="s1">&#39;rel&#39;</span><span class="p">,</span> <span class="s1">&#39;whrel&#39;</span><span class="p">,</span> <span class="s1">&#39;whsub&#39;</span><span class="p">,</span> <span class="s1">&#39;whq&#39;</span><span class="p">,</span> <span class="s1">&#39;sv1&#39;</span><span class="p">,</span> <span class="s1">&#39;svan&#39;</span><span class="p">]</span>

<span class="n">complrels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;su&#39;</span><span class="p">,</span> <span class="s1">&#39;obj1&#39;</span><span class="p">,</span> <span class="s1">&#39;pobj1&#39;</span><span class="p">,</span> <span class="s1">&#39;obj2&#39;</span><span class="p">,</span> <span class="s1">&#39;se&#39;</span><span class="p">,</span> <span class="s1">&#39;pc&#39;</span><span class="p">,</span> <span class="s1">&#39;vc&#39;</span><span class="p">,</span> <span class="s1">&#39;svp&#39;</span><span class="p">,</span> <span class="s1">&#39;predc&#39;</span><span class="p">,</span> <span class="s1">&#39;ld&#39;</span><span class="p">]</span>

<span class="n">mainclausecats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;smain&#39;</span><span class="p">,</span> <span class="s1">&#39;whq&#39;</span><span class="p">,</span> <span class="s1">&#39;sv1&#39;</span><span class="p">]</span>

<span class="n">pluralcrds</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;en&#39;</span><span class="p">,)]</span>

<span class="n">hwws_tijd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hebben&#39;</span><span class="p">,</span> <span class="s1">&#39;zijn&#39;</span><span class="p">,</span> <span class="s1">&#39;zullen&#39;</span><span class="p">]</span>
<span class="n">hwws_aspect</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gaan&#39;</span><span class="p">,</span> <span class="s1">&#39;komen&#39;</span><span class="p">,</span> <span class="s1">&#39;zijn&#39;</span><span class="p">,</span> <span class="s1">&#39;blijven&#39;</span><span class="p">,</span> <span class="s1">&#39;zitten&#39;</span><span class="p">,</span> <span class="s1">&#39;liggen&#39;</span><span class="p">,</span> <span class="s1">&#39;lopen&#39;</span><span class="p">,</span> <span class="s1">&#39;staan&#39;</span><span class="p">]</span>
<span class="n">hwws_voice</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;worden&#39;</span><span class="p">,</span> <span class="s1">&#39;zijn&#39;</span><span class="p">]</span>
<span class="n">hwws_modal</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;kunnen&#39;</span><span class="p">,</span> <span class="s1">&#39;zullen&#39;</span><span class="p">,</span> <span class="s1">&#39;mogen&#39;</span><span class="p">,</span> <span class="s1">&#39;moeten&#39;</span><span class="p">,</span> <span class="s1">&#39;willen&#39;</span><span class="p">,</span> <span class="s1">&#39;hoeven&#39;</span><span class="p">,</span> <span class="s1">&#39;horen&#39;</span><span class="p">,</span> <span class="s1">&#39;behoren&#39;</span><span class="p">]</span>
<span class="n">hwws_caus</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;doen&#39;</span><span class="p">,</span> <span class="s1">&#39;laten&#39;</span><span class="p">]</span>
<span class="n">hwws_circum</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;doen&#39;</span><span class="p">]</span>

<span class="n">tarsp_auxverbs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">hwws_tijd</span> <span class="o">+</span> <span class="n">hwws_aspect</span> <span class="o">+</span> <span class="n">hwws_voice</span> <span class="o">+</span> <span class="n">hwws_modal</span> <span class="o">+</span> <span class="n">hwws_caus</span> <span class="o">+</span> <span class="n">hwws_circum</span><span class="p">)</span>

<span class="n">potentialdet_onbvnws</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;al&#39;</span><span class="p">,</span> <span class="s1">&#39;alle&#39;</span><span class="p">,</span> <span class="s1">&#39;beide&#39;</span><span class="p">,</span> <span class="s1">&#39;een&#39;</span><span class="p">,</span> <span class="s1">&#39;elk&#39;</span><span class="p">,</span> <span class="s1">&#39;elke&#39;</span><span class="p">,</span> <span class="s1">&#39;ene&#39;</span><span class="p">,</span> <span class="s1">&#39;enig&#39;</span><span class="p">,</span> <span class="s1">&#39;enige&#39;</span><span class="p">,</span> <span class="s1">&#39;enkel&#39;</span><span class="p">,</span> <span class="s1">&#39;ettelijke&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;evenveel&#39;</span><span class="p">,</span> <span class="s1">&#39;geen&#39;</span><span class="p">,</span> <span class="s1">&#39;ieder&#39;</span><span class="p">,</span> <span class="s1">&#39;meer&#39;</span><span class="p">,</span> <span class="s1">&#39;meerdere&#39;</span><span class="p">,</span> <span class="s1">&#39;menig&#39;</span><span class="p">,</span> <span class="s1">&#39;minder&#39;</span><span class="p">,</span> <span class="s1">&#39;minst&#39;</span><span class="p">,</span> <span class="s1">&#39;sommig&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;teveel&#39;</span><span class="p">,</span> <span class="s1">&#39;tevéél&#39;</span><span class="p">,</span> <span class="s1">&#39;veel&#39;</span><span class="p">,</span> <span class="s1">&#39;weinig&#39;</span><span class="p">,</span> <span class="s1">&#39;één&#39;</span><span class="p">,</span> <span class="s1">&#39;keiveel&#39;</span><span class="p">}</span>

<span class="c1"># uttidquery = &quot;//meta[@name=&#39;uttid&#39;]/@value&quot;</span>
<span class="n">sentidxpath</span> <span class="o">=</span> <span class="s1">&#39;.//sentence/@sentid&#39;</span>

<span class="c1"># altquery = &quot;//meta[@name=&#39;alt&#39;]/@value&quot;</span>
<span class="n">metaquerytemplate</span> <span class="o">=</span> <span class="s2">&quot;//meta[@name=&#39;</span><span class="si">{}</span><span class="s2">&#39;]/@value&quot;</span>
<span class="n">sentencexpathquery</span> <span class="o">=</span> <span class="s2">&quot;//sentence/text()&quot;</span>

<span class="n">uniquecounter</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">countattvalxpathtemplate</span> <span class="o">=</span> <span class="s1">&#39;count(.//node[@</span><span class="si">{att}</span><span class="s1">=&quot;</span><span class="si">{val}</span><span class="s1">&quot;])&#39;</span>
<span class="n">countcompoundxpath</span> <span class="o">=</span> <span class="s1">&#39;count(.//node[contains(@lemma, &quot;_&quot;)])&#39;</span>


<span class="k">def</span> <span class="nf">countav</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">countattvalxpath</span> <span class="o">=</span> <span class="n">countattvalxpathtemplate</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">countattvalxpath</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">modalinv</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">infl</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;infl&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">infl</span> <span class="o">==</span> <span class="s1">&#39;modal_inv&#39;</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">getcompoundcount</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">countcompoundxpath</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">copymodifynode</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">dct</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
    <span class="n">newnode</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
        <span class="n">newnode</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">=</span> <span class="n">dct</span><span class="p">[</span><span class="n">att</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">newnode</span>


<span class="k">def</span> <span class="nf">myfind</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SynTree</span><span class="p">]:</span>
    <span class="nb">list</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">list</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">getmeta</span><span class="p">(</span><span class="n">syntree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">attname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">treebank</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span> <span class="k">if</span> <span class="n">treebank</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">thequery</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">metaquerytemplate</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attname</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">getqueryresult</span><span class="p">(</span><span class="n">syntree</span><span class="p">,</span> <span class="n">xpathquery</span><span class="o">=</span><span class="n">thequery</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">normalizedword</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">stree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="s1">&#39;pt&#39;</span> <span class="ow">in</span> <span class="n">stree</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
        <span class="n">theword</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">)</span>
        <span class="n">thelemma</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="s1">&#39;lemma&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">theword</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">theword</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">thelemma</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">thelemma</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">theword</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">theword</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="ow">and</span> <span class="n">thelemma</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">theword</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">theword</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">mkproper</span><span class="p">(</span><span class="n">astring</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">astring</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">getproperuttid</span><span class="p">(</span><span class="n">syntree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">uniquecounter</span>
    <span class="n">result1</span> <span class="o">=</span> <span class="n">getmeta</span><span class="p">(</span><span class="n">syntree</span><span class="p">,</span> <span class="s1">&#39;uttid&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;U&#39;</span> <span class="o">+</span> <span class="n">mkproper</span><span class="p">(</span><span class="n">result1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result1</span> <span class="o">=</span> <span class="n">getsentid</span><span class="p">(</span><span class="n">syntree</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;S&#39;</span> <span class="o">+</span> <span class="n">mkproper</span><span class="p">(</span><span class="n">result1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">uniquecounter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">result1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uniquecounter</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span> <span class="o">+</span> <span class="n">mkproper</span><span class="p">(</span><span class="n">result1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">ismainclausenode</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">nodecat</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">)</span>
    <span class="n">catok</span> <span class="o">=</span> <span class="n">nodecat</span> <span class="ow">in</span> <span class="n">mainclausecats</span>
    <span class="k">if</span> <span class="n">nodecat</span> <span class="o">==</span> <span class="s1">&#39;sv1&#39;</span><span class="p">:</span>
        <span class="n">parentnode</span> <span class="o">=</span> <span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">parentnodecat</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">parentnode</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">)</span>
        <span class="n">sv1ok</span> <span class="o">=</span> <span class="n">parentnodecat</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;whq&#39;</span><span class="p">,</span> <span class="s1">&#39;cp&#39;</span><span class="p">,</span> <span class="s1">&#39;rel&#39;</span><span class="p">,</span> <span class="s1">&#39;whrel&#39;</span><span class="p">,</span> <span class="s1">&#39;whsub&#39;</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">sv1ok</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">catok</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">getnodeendmap</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">PositionStr</span><span class="p">,</span> <span class="n">Position</span><span class="p">]:</span>
    <span class="n">leaves</span> <span class="o">=</span> <span class="n">getnodeyield</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">getattval</span><span class="p">(</span><span class="n">leave</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">):</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">leave</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">leaves</span><span class="p">)}</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">getxselseuttid</span><span class="p">(</span><span class="n">syntree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UttId</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">getmeta</span><span class="p">(</span><span class="n">syntree</span><span class="p">,</span> <span class="s1">&#39;xsid&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">getmeta</span><span class="p">(</span><span class="n">syntree</span><span class="p">,</span> <span class="s1">&#39;uttid&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">getsentid</span><span class="p">(</span><span class="n">syntree</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">getuttid</span><span class="p">(</span><span class="n">syntree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UttId</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">getmeta</span><span class="p">(</span><span class="n">syntree</span><span class="p">,</span> <span class="s1">&#39;uttid&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">getsentid</span><span class="p">(</span><span class="n">syntree</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">getuttno</span><span class="p">(</span><span class="n">syntree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UttId</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">getmeta</span><span class="p">(</span><span class="n">syntree</span><span class="p">,</span> <span class="s1">&#39;uttno&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">getuttidorno</span><span class="p">(</span><span class="n">syntree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UttId</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">getmeta</span><span class="p">(</span><span class="n">syntree</span><span class="p">,</span> <span class="s1">&#39;xsid&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">getmeta</span><span class="p">(</span><span class="n">syntree</span><span class="p">,</span> <span class="s1">&#39;uttno&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">getxsid</span><span class="p">(</span><span class="n">syntree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UttId</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">getmeta</span><span class="p">(</span><span class="n">syntree</span><span class="p">,</span> <span class="s1">&#39;xsid&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">getaltid</span><span class="p">(</span><span class="n">syntree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">getmeta</span><span class="p">(</span><span class="n">syntree</span><span class="p">,</span> <span class="s1">&#39;alt&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">noxpathsentid</span><span class="p">(</span><span class="n">syntree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">UttId</span><span class="p">]:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">syntree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">syntree</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;sentence&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;sentid&#39;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;sentid&#39;</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">results</span>

<span class="c1">#put the next one in comments, see below for a different definition</span>
<span class="c1"># def getsentid(syntree: SynTree) -&gt; Optional[UttId]:</span>
<span class="c1">#     result = getqueryresult(syntree, noxpathquery=noxpathsentid)</span>
<span class="c1">#     return result</span>


<span class="k">def</span> <span class="nf">lastconstituentof</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="n">curlastend</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">topnodes</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;.//node[@cat=&quot;top&quot;]&#39;</span><span class="p">)</span>
    <span class="n">topnode</span> <span class="o">=</span> <span class="n">topnodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">topnode</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;cat&#39;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
            <span class="n">childend</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">getattval</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">childend</span> <span class="o">&gt;</span> <span class="n">curlastend</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">child</span>
                <span class="n">curlastend</span> <span class="o">=</span> <span class="n">childend</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">getsentence</span><span class="p">(</span><span class="n">syntree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">treebank</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span> <span class="k">if</span> <span class="n">treebank</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">thequery</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">sentencexpathquery</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">getqueryresult</span><span class="p">(</span><span class="n">syntree</span><span class="p">,</span> <span class="n">xpathquery</span><span class="o">=</span><span class="n">thequery</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">lastmainclauseof</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="n">topnodes</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;.//node[@cat=&quot;top&quot;]&#39;</span><span class="p">)</span>
    <span class="n">curlastmainclause</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">topnodes</span> <span class="o">!=</span> <span class="p">[]:</span>
        <span class="n">topnode</span> <span class="o">=</span> <span class="n">topnodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">topnode</span><span class="p">:</span>
            <span class="n">curlastmainclause</span> <span class="o">=</span> <span class="n">reclastmainclauseof</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">curlastmainclause</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">curlastmainclause</span>


<span class="k">def</span> <span class="nf">reclastmainclauseof</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">current</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">current</span>
    <span class="k">elif</span> <span class="n">ismainclausenode</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
        <span class="n">currentend</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">getattval</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">))</span> <span class="k">if</span> <span class="n">current</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">nodeend</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">nodeend</span> <span class="o">&gt;</span> <span class="n">currentend</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">node</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">current</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">reclastmainclauseof</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">current</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">getrelchildof</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">rel</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    gets the first child node with rel=rel under a node.</span>
<span class="sd">    It should always return a word node (so should have a pt attribute; it does not deal properly with conjunction</span>
<span class="sd">    :return: node with grammatical relation rel</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
        <span class="n">chrel</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;rel&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">chrel</span> <span class="o">==</span> <span class="n">rel</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">child</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">getheadof</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">getrelchildof</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;hd&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">getdetof</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">getrelchildof</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;det&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">getfirstconjunctof</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">getrelchildof</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;cnj&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">getextendedheadof</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="n">result1</span> <span class="o">=</span> <span class="n">getheadof</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result2</span> <span class="o">=</span> <span class="n">getfirstconjunctof</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;cat&#39;</span> <span class="ow">in</span> <span class="n">result2</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">getheadof</span><span class="p">(</span><span class="n">result2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">result2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;here it goes wrong&#39;</span><span class="p">)</span>
            <span class="k">pass</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result1</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="n">persons</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;persoon&#39;</span><span class="p">,</span> <span class="s1">&#39;3p&#39;</span><span class="p">,</span> <span class="s1">&#39;3m&#39;</span><span class="p">,</span> <span class="s1">&#39;3v&#39;</span><span class="p">,</span> <span class="s1">&#39;3o&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;2v&#39;</span><span class="p">,</span> <span class="s1">&#39;2b&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">]</span>
<span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;getal&#39;</span><span class="p">,</span> <span class="s1">&#39;ev&#39;</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">]</span>
<span class="n">genders</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;genus&#39;</span><span class="p">,</span> <span class="s1">&#39;onz&#39;</span><span class="p">,</span> <span class="s1">&#39;zijd&#39;</span><span class="p">,</span> <span class="s1">&#39;fem&#39;</span><span class="p">,</span> <span class="s1">&#39;masc&#39;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">valmerge</span><span class="p">(</span><span class="n">v1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">v2</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">vallist</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    presupposes that v1 and v2 occur in the vallist</span>
<span class="sd">    :param v1:</span>
<span class="sd">    :param v2:</span>
<span class="sd">    :param vallist:</span>
<span class="sd">    :return:</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">v1ind</span> <span class="o">=</span> <span class="n">vallist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
    <span class="n">v2ind</span> <span class="o">=</span> <span class="n">vallist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
    <span class="n">newind</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">v1ind</span><span class="p">,</span> <span class="n">v2ind</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">vallist</span><span class="p">[</span><span class="n">newind</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">phimax</span><span class="p">(</span><span class="n">v1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">v2</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">persons</span> <span class="ow">and</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">persons</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">valmerge</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">persons</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">numbers</span> <span class="ow">and</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">valmerge</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">numbers</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">genders</span> <span class="ow">and</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">genders</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">valmerge</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">genders</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Phimax: Illegal or incompatible value combination: V1=</span><span class="si">{}</span><span class="s1">, v2=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">v1</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">phi1</span><span class="p">:</span> <span class="n">OptPhiTriple</span><span class="p">,</span> <span class="n">phi2</span><span class="p">:</span> <span class="n">OptPhiTriple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OptPhiTriple</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">phi1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">phi2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">g1</span><span class="p">)</span> <span class="o">=</span> <span class="n">phi1</span>
        <span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">g2</span><span class="p">)</span> <span class="o">=</span> <span class="n">phi2</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">phimax</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">),</span> <span class="n">phimax</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">),</span> <span class="n">phimax</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">getconjphi</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OptPhiTriple</span><span class="p">:</span>
    <span class="n">crd</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;node[@rel=&quot;crd&quot;]&#39;</span><span class="p">))</span>
    <span class="n">conjs</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;node[@rel=&quot;cnj&quot;]&#39;</span><span class="p">)</span>
    <span class="n">conjphis</span> <span class="o">=</span> <span class="p">[</span><span class="n">getphi</span><span class="p">(</span><span class="n">conj</span><span class="p">)</span> <span class="k">for</span> <span class="n">conj</span> <span class="ow">in</span> <span class="n">conjs</span><span class="p">]</span>
    <span class="n">startphi</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;getal&#39;</span><span class="p">,</span> <span class="s1">&#39;genus&#39;</span><span class="p">)</span>
    <span class="n">curphi</span><span class="p">:</span>  <span class="n">OptPhiTriple</span> <span class="o">=</span> <span class="n">startphi</span>
    <span class="k">for</span> <span class="n">conjphi</span> <span class="ow">in</span> <span class="n">conjphis</span><span class="p">:</span>
        <span class="n">curphi</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">curphi</span><span class="p">,</span> <span class="n">conjphi</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">curphi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">crd</span> <span class="ow">in</span> <span class="n">pluralcrds</span><span class="p">:</span>
            <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span> <span class="o">=</span> <span class="n">curphi</span>
            <span class="n">curphi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">curphi</span>


<span class="k">def</span> <span class="nf">getlemma</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">elif</span> <span class="s1">&#39;cat&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
        <span class="n">nodecat</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nodecat</span> <span class="o">==</span> <span class="s1">&#39;conj&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">nodecat</span> <span class="o">==</span> <span class="s1">&#39;mwu&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hnode</span> <span class="o">=</span> <span class="n">getheadof</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">getlemma</span><span class="p">(</span><span class="n">hnode</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;pt&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;lemma&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">getphi</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PhiTriple</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="s1">&#39;cat&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
        <span class="n">nodecat</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nodecat</span> <span class="o">==</span> <span class="s1">&#39;conj&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">getconjphi</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">elif</span> <span class="n">nodecat</span> <span class="o">==</span> <span class="s1">&#39;mwu&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;getal&#39;</span><span class="p">,</span> <span class="s1">&#39;genus&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hnode</span> <span class="o">=</span> <span class="n">getheadof</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">getphi</span><span class="p">(</span><span class="n">hnode</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
    <span class="k">elif</span> <span class="s1">&#39;pt&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;persoon&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
            <span class="n">person</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;persoon&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">person</span> <span class="o">=</span> <span class="s1">&#39;3&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;getal&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
            <span class="n">number</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;getal&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">number</span> <span class="o">=</span> <span class="s1">&#39;ev&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;genus&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
            <span class="n">gender</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;genus&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gender</span> <span class="o">=</span> <span class="s1">&#39;genus&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">gender</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">inverted</span><span class="p">(</span><span class="n">thesubj</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">thepv</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">subjphi</span> <span class="o">=</span> <span class="n">getphi</span><span class="p">(</span><span class="n">thesubj</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">subjphi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="p">(</span><span class="n">subjperson</span><span class="p">,</span> <span class="n">subjnumber</span><span class="p">,</span> <span class="n">subjgender</span><span class="p">)</span> <span class="o">=</span> <span class="n">subjphi</span>
    <span class="n">tense</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">thepv</span><span class="p">,</span> <span class="s1">&#39;pvtijd&#39;</span><span class="p">)</span>
    <span class="n">subjbegin</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">thesubj</span><span class="p">,</span> <span class="s1">&#39;begin&#39;</span><span class="p">)</span>
    <span class="n">subjlemma</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">thesubj</span><span class="p">,</span> <span class="s1">&#39;lemma&#39;</span><span class="p">)</span>
    <span class="n">pvend</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">thepv</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
    <span class="c1"># maybe defien immediately-follows for inflated trees</span>
    <span class="n">inversion</span> <span class="o">=</span> <span class="s1">&#39;2&#39;</span> <span class="o">==</span> <span class="n">subjperson</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">tense</span> <span class="o">==</span> <span class="s1">&#39;tgw&#39;</span> <span class="ow">and</span> <span class="n">subjnumber</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ev&#39;</span><span class="p">,</span> <span class="s1">&#39;getal&#39;</span><span class="p">]</span> <span class="ow">and</span> \
                <span class="n">pvend</span> <span class="o">&lt;=</span> <span class="n">subjbegin</span> <span class="ow">and</span> <span class="n">subjlemma</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;jij&#39;</span><span class="p">,</span> <span class="s1">&#39;je&#39;</span><span class="p">]</span>  <span class="c1"># getal added for je</span>
    <span class="k">return</span> <span class="n">inversion</span>


<span class="k">def</span> <span class="nf">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">att</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">elif</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">att</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">is_number</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">number2intstring</span><span class="p">(</span><span class="n">numberstr</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">is_number</span><span class="p">(</span><span class="n">numberstr</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">numberstr</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">numberstr</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">getqueryresult</span><span class="p">(</span><span class="n">syntree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">xpathquery</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> \
                   <span class="n">noxpathquery</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">SynTree</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">syntree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xpathquery</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">syntree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">xpathquery</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">noxpathquery</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">noxpathquery</span><span class="p">(</span><span class="n">syntree</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">result1</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">number2intstring</span><span class="p">(</span><span class="n">result1</span><span class="p">)</span>
            <span class="c1">##issue a warning</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">result1</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">number2intstring</span><span class="p">(</span><span class="n">result1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">getnodeyield</span><span class="p">(</span><span class="n">syntree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SynTree</span><span class="p">]:</span>
    <span class="n">resultlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">syntree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">syntree</span><span class="o">.</span><span class="n">iter</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;pt&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span> <span class="ow">or</span> <span class="s1">&#39;pos&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="n">resultlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">sortedresultlist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">resultlist</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">getattval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">sortedresultlist</span>


<span class="k">def</span> <span class="nf">getyield</span><span class="p">(</span><span class="n">syntree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>  <span class="c1"># deze herformuleren in termen van getnodeyield na testen</span>
    <span class="n">resultlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">syntree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">theyield</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">syntree</span><span class="o">.</span><span class="n">iter</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;pt&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span> <span class="ow">or</span> <span class="s1">&#39;pos&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;word&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span> <span class="ow">and</span> <span class="s1">&#39;end&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                    <span class="n">newel</span> <span class="o">=</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;word&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]))</span>
                    <span class="n">resultlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newel</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;word&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                        <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No word in pt or pos node&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;end&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                        <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No end in pt or pos node&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                        <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">el</span><span class="p">]))</span>
        <span class="n">sortedresultlist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">resultlist</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">theyield</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">sortedresultlist</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">theyield</span>


<span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SynTree</span><span class="p">]:</span>
    <span class="n">pnodes</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;parent::node&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pnodes</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">pnodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">is_left_sibling</span><span class="p">(</span><span class="n">node1</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">node2</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">sameparent</span> <span class="o">=</span> <span class="n">parent</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span> <span class="o">==</span> <span class="n">parent</span><span class="p">(</span><span class="n">node2</span><span class="p">)</span>
    <span class="n">node1_end</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
    <span class="n">node2_end</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">sameparent</span> <span class="ow">and</span> <span class="n">node1_end</span> <span class="o">&lt;</span> <span class="n">node2_end</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">get_left_siblings</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SynTree</span><span class="p">]:</span>
    <span class="n">thesiblings</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;../node&#39;</span><span class="p">)</span>
    <span class="n">theleftsiblings</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">thesiblings</span> <span class="k">if</span> <span class="n">is_left_sibling</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">node</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">theleftsiblings</span>


<span class="k">def</span> <span class="nf">getmarkedutt</span><span class="p">(</span><span class="n">m</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">syntree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">thewordlist</span> <span class="o">=</span> <span class="n">getyield</span><span class="p">(</span><span class="n">syntree</span><span class="p">)</span>
    <span class="n">thepositions</span> <span class="o">=</span> <span class="n">getwordpositions</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">syntree</span><span class="p">)</span>
    <span class="n">themarkedyield</span> <span class="o">=</span> <span class="n">getmarkedyield</span><span class="p">(</span><span class="n">thewordlist</span><span class="p">,</span> <span class="n">thepositions</span><span class="p">)</span>
    <span class="n">yieldstr</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">themarkedyield</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">yieldstr</span>


<span class="k">def</span> <span class="nf">mark</span><span class="p">(</span><span class="nb">str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="nb">str</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">getwordpositions</span><span class="p">(</span><span class="n">matchtree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">syntree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Position</span><span class="p">]:</span>
    <span class="c1"># nothing special needs to be done for index nodes since they also have begin and end</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">matchtree</span><span class="o">.</span><span class="n">iter</span><span class="p">():</span>
        <span class="k">if</span> <span class="s1">&#39;end&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
            <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">])</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">getmarkedyield</span><span class="p">(</span><span class="n">wordlist</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">positions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Position</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">resultlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
        <span class="n">resultlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mark</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">wordlist</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
            <span class="n">resultlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mark</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">resultlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">resultlist</span>


<span class="k">def</span> <span class="nf">addmetadata</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">meta</span><span class="p">:</span> <span class="n">Metadata</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    adds  meta of class Metadata to stree</span>
<span class="sd">    :param stree:</span>
<span class="sd">    :param meta: type Metadata</span>
<span class="sd">    :return: stree</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">stree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">stree</span>
    <span class="k">elif</span> <span class="n">meta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">stree</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">metadatanodes</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//metadata&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">metadatanodes</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">metadatanode</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;metadata&#39;</span><span class="p">)</span>
            <span class="n">stree</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metadatanode</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">metadatanode</span> <span class="o">=</span> <span class="n">metadatanodes</span><span class="p">[</span>
                <span class="mi">0</span><span class="p">]</span>  <span class="c1"># we append to the first metadata node if there would be multiple (which should not be the case)</span>
        <span class="n">metadatanode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">stree</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">iswordnode</span><span class="p">(</span><span class="n">thenode</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;pt&#39;</span> <span class="ow">in</span> <span class="n">thenode</span><span class="o">.</span><span class="n">attrib</span> <span class="ow">or</span> <span class="s1">&#39;pos&#39;</span> <span class="ow">in</span> <span class="n">thenode</span><span class="o">.</span><span class="n">attrib</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">istrueclausalnode</span><span class="p">(</span><span class="n">thenode</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">thenodecat</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">thenode</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">)</span>
    <span class="n">result1</span> <span class="o">=</span> <span class="n">thenodecat</span> <span class="ow">in</span> <span class="n">trueclausecats</span>
    <span class="k">if</span> <span class="n">result1</span><span class="p">:</span>
        <span class="n">ssubfound</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">thenode</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">getattval</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ssub&#39;</span><span class="p">:</span>
                <span class="n">ssubfound</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">ssubfound</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">iscompound</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">lemma</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;lemma&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">compoundsep</span> <span class="ow">in</span> <span class="n">lemma</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">isdiminutive</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">graad</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;graad&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">graad</span> <span class="o">==</span> <span class="s1">&#39;dim&#39;</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">issubstantivised_verb</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">nodept</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;pt&#39;</span><span class="p">)</span>
    <span class="n">nodepositie</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;positie&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">nodept</span> <span class="o">==</span> <span class="s1">&#39;ww&#39;</span> <span class="ow">and</span> <span class="n">nodepositie</span> <span class="o">==</span> <span class="s1">&#39;nom&#39;</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">getsiblings</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SynTree</span><span class="p">]:</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
    <span class="n">siblings</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">parent</span> <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">node</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">siblings</span>


<span class="k">def</span> <span class="nf">showtn</span><span class="p">(</span><span class="n">tokennode</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;requires the node to be a node for a token (word)&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">tokennode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">tokennode</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">)</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">tokennode</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">position</span> <span class="o">+</span> <span class="n">word</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">showtns</span><span class="p">(</span><span class="n">tokennodelist</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SynTree</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">showtn</span><span class="p">(</span><span class="n">tn</span><span class="p">)</span> <span class="k">for</span> <span class="n">tn</span> <span class="ow">in</span> <span class="n">tokennodelist</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">all_lower_consonantsnode</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">islower</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word</span><span class="p">])</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">allconsonants</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">sasta_long</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_sasta_length</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">spec_noun</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;pt&#39;</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;pos&#39;</span><span class="p">)</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;frame&#39;</span><span class="p">)</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt</span> <span class="o">==</span> <span class="s1">&#39;spec&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;name&#39;</span> <span class="ow">or</span> <span class="n">frame</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;proper_name&#39;</span><span class="p">)))</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">is_duplicate_spec_noun</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">siblings</span> <span class="o">=</span> <span class="n">getsiblings</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">)</span>
    <span class="n">lcword</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">sibling</span> <span class="ow">in</span> <span class="n">siblings</span><span class="p">:</span>
        <span class="n">siblingword</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">sibling</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">)</span>
        <span class="n">lcsiblingword</span> <span class="o">=</span> <span class="n">siblingword</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">lcword</span> <span class="o">==</span> <span class="n">lcsiblingword</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">onbvnwdet</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;lemma&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">potentialdet_onbvnws</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">asta_recognised_lexnode</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">issubstantivised_verb</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;pt&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ww&#39;</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">asta_recognised_nounnode</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">issubstantivised_verb</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="s1">&#39;ww&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">sasta_pseudonym</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">or</span> <span class="n">spec_noun</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">or</span> <span class="n">is_duplicate_spec_noun</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">or</span> <span class="n">sasta_long</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">or</span> <span class="n">recognised_wordnodepos</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">or</span> <span class="n">recognised_lemmanodepos</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">all_lower_consonantsnode</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">short_nucl_n</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">asta_recognised_wordnode</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">sasta_pseudonym</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">or</span> <span class="n">spec_noun</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">or</span> <span class="n">is_duplicate_spec_noun</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">or</span> <span class="n">sasta_long</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">or</span> <span class="n">recognised_wordnode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">or</span> <span class="n">recognised_lemmanode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">or</span> <span class="n">isnumber</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">all_lower_consonantsnode</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">short_nucl_n</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">isnumber</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">)</span>
    <span class="n">thematch</span> <span class="o">=</span> <span class="n">numberre</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">thematch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">sasta_short</span><span class="p">(</span><span class="n">inval</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inval</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">sasta_short_length</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">short_nucl_n</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;pt&#39;</span><span class="p">)</span>
    <span class="n">rel</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;rel&#39;</span><span class="p">)</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pt</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span> <span class="ow">and</span> <span class="n">rel</span> <span class="o">==</span> <span class="s1">&#39;nucl&#39;</span> <span class="ow">and</span> <span class="n">sasta_short</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="n">sasta_pseudonyms</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NAAM&#39;</span><span class="p">,</span> <span class="s1">&#39;VOORNAAM&#39;</span><span class="p">,</span> <span class="s1">&#39;ACHTERNAAM&#39;</span><span class="p">,</span> <span class="s1">&#39;ZIEKENHUIS&#39;</span><span class="p">,</span> <span class="s1">&#39;STRAAT&#39;</span><span class="p">,</span> <span class="s1">&#39;PLAATS&#39;</span><span class="p">,</span> <span class="s1">&#39;PLAATSNAAM&#39;</span><span class="p">,</span> <span class="s1">&#39;KIND&#39;</span><span class="p">,</span> <span class="s1">&#39;BEROEP&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;OPLEIDING&#39;</span><span class="p">]</span>
<span class="n">pseudonym_patternlist</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;^</span><span class="si">{}</span><span class="s1">\d?$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">sasta_pseudonyms</span><span class="p">]</span>
<span class="n">pseudonym_pattern</span> <span class="o">=</span> <span class="n">vertbar</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pseudonym_patternlist</span><span class="p">)</span>
<span class="n">pseudonymre</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pseudonym_pattern</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">sasta_pseudonym</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">)</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">pseudonymre</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">recognised_wordnodepos</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">)</span>
    <span class="n">lcword</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">lex</span><span class="o">.</span><span class="n">informlexiconpos</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span> <span class="ow">or</span> <span class="n">lex</span><span class="o">.</span><span class="n">informlexiconpos</span><span class="p">(</span><span class="n">lcword</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span> <span class="ow">or</span> \
             <span class="n">iscompound</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">or</span> <span class="n">isdiminutive</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">or</span> <span class="n">lex</span><span class="o">.</span><span class="n">isa_namepart_uc</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">recognised_wordnode</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">)</span>
    <span class="n">lcword</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">lex</span><span class="o">.</span><span class="n">informlexicon</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="ow">or</span> <span class="n">lex</span><span class="o">.</span><span class="n">informlexicon</span><span class="p">(</span><span class="n">lcword</span><span class="p">)</span> <span class="ow">or</span> <span class="n">iscompound</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">or</span> <span class="n">isdiminutive</span><span class="p">(</span>
        <span class="n">node</span><span class="p">)</span> <span class="ow">or</span> <span class="n">lex</span><span class="o">.</span><span class="n">isa_namepart</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">recognised_lemmanode</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">lemma</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;lemma&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">lex</span><span class="o">.</span><span class="n">informlexicon</span><span class="p">(</span><span class="n">lemma</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">recognised_lemmanodepos</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">lemma</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;lemma&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">lex</span><span class="o">.</span><span class="n">informlexiconpos</span><span class="p">(</span><span class="n">lemma</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="n">nodeformat</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}{}</span><span class="s1">&#39;</span>
<span class="n">nodeformatplus</span> <span class="o">=</span> <span class="n">nodeformat</span> <span class="o">+</span> <span class="s1">&#39;[&#39;</span>

<span class="c1">##@@need to add a variant that returns a string</span>

<span class="k">def</span> <span class="nf">simpleshow</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">showchildren</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">newline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">simpleshow2</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="n">showchildren</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">newline</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">simpleshow2</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">showchildren</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">rel</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="s1">&#39;rel&#39;</span><span class="p">)</span>
    <span class="n">cat</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">)</span>
    <span class="n">indexstr</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">index</span> <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
    <span class="n">begin</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="s1">&#39;begin&#39;</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
    <span class="n">theformat</span> <span class="o">=</span> <span class="n">nodeformatplus</span> <span class="k">if</span> <span class="n">showchildren</span> <span class="k">else</span> <span class="n">nodeformat</span>
    <span class="k">if</span> <span class="n">cat</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">theformat</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rel</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="n">indexstr</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">showchildren</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">stree</span><span class="p">:</span>
                <span class="n">simpleshow2</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">begin</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">getattval</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="s1">&#39;pt&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">nodeformat</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rel</span><span class="p">,</span> <span class="n">showtn</span><span class="p">(</span><span class="n">stree</span><span class="p">),</span> <span class="n">indexstr</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">getattval</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="s1">&#39;pos&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">nodeformat</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rel</span><span class="p">,</span> <span class="n">showtn</span><span class="p">(</span><span class="n">stree</span><span class="p">),</span> <span class="n">indexstr</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">nodeformat</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rel</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">indexstr</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># print(&#39;top&#39;, end=&#39; &#39;)</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">stree</span><span class="p">:</span>
                <span class="n">simpleshow2</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="c1"># print(&#39;]&#39;, end=&#39; &#39;)</span>


<span class="k">def</span> <span class="nf">showflatxml</span><span class="p">(</span><span class="n">elem</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    :param elem: xml element</span>
<span class="sd">    :return: string that represents the element and its immediate children</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;&lt;/</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
    <span class="n">middle</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">/&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">elem</span><span class="p">]</span>
    <span class="n">middlestr</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">middle</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">middlestr</span> <span class="o">+</span> <span class="n">end</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">uniquenodes</span><span class="p">(</span><span class="n">nodelist</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SynTree</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SynTree</span><span class="p">]:</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    :param nodelist: list of nodes all from a single syntactic structure</span>
<span class="sd">    :return: nodelist without duplicates. Two nodes are considered duplicates if the begin and end attributes are identical</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">done</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">resultlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">:</span>
        <span class="n">begin</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;begin&#39;</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
        <span class="n">cover</span> <span class="o">=</span> <span class="n">begin</span><span class="p">,</span> <span class="n">end</span>
        <span class="k">if</span> <span class="n">cover</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
            <span class="n">resultlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">done</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cover</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resultlist</span>


<span class="k">def</span> <span class="nf">getindexednodesmap</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SynTree</span><span class="p">]:</span>
    <span class="n">indexednodes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">stree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">stree</span><span class="o">.</span><span class="n">iter</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;index&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;pt&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span> <span class="ow">or</span> <span class="s1">&#39;cat&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span> <span class="ow">or</span> <span class="s1">&#39;pos&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">):</span>
                <span class="n">theindex</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>
                <span class="n">indexednodes</span><span class="p">[</span><span class="n">theindex</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
    <span class="k">return</span> <span class="n">indexednodes</span>


<span class="k">def</span> <span class="nf">nodecopy</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    copies a node without its children</span>
<span class="sd">    :param node: node, an lxml.etree Element</span>
<span class="sd">    :return: a node with no children, otherwise a copy of the input node</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">newnode</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">newnode</span><span class="p">:</span>
            <span class="n">newnode</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newnode</span>


<span class="k">def</span> <span class="nf">bareindexnode</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">terminal</span><span class="p">(</span>
        <span class="n">node</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;index&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span> <span class="ow">and</span> <span class="s1">&#39;postag&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span> <span class="ow">and</span> <span class="s1">&#39;cat&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span> <span class="ow">and</span> <span class="s1">&#39;pt&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span> <span class="ow">and</span> <span class="s1">&#39;pos&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span>
    <span class="c1"># print(props2str(get_node_props(node)), result, file=sys.stderr)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c1">##herdefinieren want met UD hebben terminale nodes wel children (maar geen children met tag=node)</span>
<span class="k">def</span> <span class="nf">terminal</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">_Element</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">indextransform</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    produces a new stree in which all index nodes are replaced by their antecedent nodes</span>
<span class="sd">    :param stree: input stree</span>
<span class="sd">    :return: stree with all index nodes replaced by the nodes of their antecedents</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">indexednodesmap</span> <span class="o">=</span> <span class="n">getindexednodesmap</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">indextransform2</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="n">indexednodesmap</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="c1">##deze robuust maken tegen andere nodes dan node (metadata, alpino_ds etc)</span>
<span class="c1">## waarschijnlijk is node.tag == &#39;node&#39;in baseindexnode voldoende</span>
<span class="k">def</span> <span class="nf">indextransform2</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">indexednodesmap</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SynTree</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">stree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bareindexnode</span><span class="p">(</span><span class="n">stree</span><span class="p">):</span>
            <span class="n">theindex</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">)</span>
            <span class="n">therel</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="s1">&#39;rel&#39;</span><span class="p">)</span>
            <span class="n">newstree</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">indexednodesmap</span><span class="p">[</span><span class="n">theindex</span><span class="p">])</span>
            <span class="n">newstree</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;rel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">therel</span>
            <span class="c1"># simpleshow(newstree)</span>
            <span class="c1"># print()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newstree</span> <span class="o">=</span> <span class="n">nodecopy</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
            <span class="c1"># simpleshow(newstree)</span>
            <span class="c1"># print(id(stree))</span>
            <span class="c1"># print(id(newstree))</span>
            <span class="c1"># print(len(newstree))</span>
            <span class="c1"># print(id(newstree.getparent()))</span>
            <span class="c1"># print(id(None))</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">stree</span><span class="p">:</span>
                <span class="n">newchild</span> <span class="o">=</span> <span class="n">indextransform2</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">indexednodesmap</span><span class="p">)</span>
                <span class="n">newstree</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newchild</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">newstree</span>


<span class="k">def</span> <span class="nf">getstree</span><span class="p">(</span><span class="n">fullname</span><span class="p">:</span> <span class="n">FileName</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">thefile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;File not found: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="n">etree</span><span class="o">.</span><span class="n">ParseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Parse Error: </span><span class="si">{}</span><span class="s1">; file: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">fullname</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;OS Error: </span><span class="si">{}</span><span class="s1">; file: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">fullname</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error: Unknown error in file </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fullname</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">with</span> <span class="n">thefile</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">thefile</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">etree</span><span class="o">.</span><span class="n">ParseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Parse Error: </span><span class="si">{}</span><span class="s1">; file: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">fullname</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Unicode error: </span><span class="si">{}</span><span class="s1"> in file </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">fullname</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">windowsfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">windowsfile</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Char Descoding Error: </span><span class="si">{}</span><span class="s1">; file: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">fullname</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="n">etree</span><span class="o">.</span><span class="n">ParseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Parse Error: </span><span class="si">{}</span><span class="s1">; file: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">fullname</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">tree</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tree</span>


<span class="n">streestrings</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">streestrings</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;alpino_ds version=&quot;1.6&quot;&gt;</span>
<span class="s1">  &lt;parser cats=&quot;1&quot; skips=&quot;5&quot; /&gt;</span>
<span class="s1">  &lt;node begin=&quot;0&quot; cat=&quot;top&quot; end=&quot;8&quot; id=&quot;0&quot; rel=&quot;top&quot;&gt;</span>
<span class="s1">    &lt;node begin=&quot;0&quot; conjtype=&quot;neven&quot; end=&quot;1&quot; frame=&quot;complementizer(root)&quot; his=&quot;robust_skip&quot; id=&quot;1&quot; lcat=&quot;--&quot; lemma=&quot;en&quot; pos=&quot;comp&quot; postag=&quot;VG(neven)&quot; pt=&quot;vg&quot; rel=&quot;--&quot; root=&quot;en&quot; sc=&quot;root&quot; sense=&quot;en&quot; word=&quot;en&quot;/&gt;</span>
<span class="s1">    &lt;node begin=&quot;1&quot; end=&quot;2&quot; frame=&quot;--&quot; genus=&quot;zijd&quot; getal=&quot;ev&quot; graad=&quot;basis&quot; his=&quot;robust_skip&quot; id=&quot;2&quot; lcat=&quot;--&quot; lemma=&quot;uhm&quot; naamval=&quot;stan&quot; ntype=&quot;soort&quot; pos=&quot;--&quot; postag=&quot;N(soort,ev,basis,zijd,stan)&quot; pt=&quot;n&quot; rel=&quot;--&quot; root=&quot;uhm&quot; sense=&quot;uhm&quot; word=&quot;uhm&quot;/&gt;</span>
<span class="s1">    &lt;node begin=&quot;2&quot; conjtype=&quot;neven&quot; end=&quot;3&quot; frame=&quot;conj(en)&quot; his=&quot;robust_skip&quot; id=&quot;3&quot; lcat=&quot;--&quot; lemma=&quot;en&quot; pos=&quot;vg&quot; postag=&quot;VG(neven)&quot; pt=&quot;vg&quot; rel=&quot;--&quot; root=&quot;en&quot; sense=&quot;en&quot; word=&quot;en&quot;/&gt;</span>
<span class="s1">    &lt;node begin=&quot;3&quot; end=&quot;4&quot; frame=&quot;--&quot; genus=&quot;zijd&quot; getal=&quot;ev&quot; graad=&quot;basis&quot; his=&quot;robust_skip&quot; id=&quot;4&quot; lcat=&quot;--&quot; lemma=&quot;uhm&quot; naamval=&quot;stan&quot; ntype=&quot;soort&quot; pos=&quot;--&quot; postag=&quot;N(soort,ev,basis,zijd,stan)&quot; pt=&quot;n&quot; rel=&quot;--&quot; root=&quot;uhm&quot; sense=&quot;uhm&quot; word=&quot;uhm&quot;/&gt;</span>
<span class="s1">    &lt;node begin=&quot;4&quot; case=&quot;nom&quot; def=&quot;def&quot; end=&quot;5&quot; frame=&quot;pronoun(nwh,thi,sg,de,nom,def)&quot; gen=&quot;de&quot; genus=&quot;masc&quot; getal=&quot;ev&quot; his=&quot;robust_skip&quot; id=&quot;5&quot; lcat=&quot;--&quot; lemma=&quot;hij&quot; naamval=&quot;nomin&quot; num=&quot;sg&quot; pdtype=&quot;pron&quot; per=&quot;thi&quot; persoon=&quot;3&quot; pos=&quot;pron&quot; postag=&quot;VNW(pers,pron,nomin,vol,3,ev,masc)&quot; pt=&quot;vnw&quot; rel=&quot;--&quot; root=&quot;hij&quot; sense=&quot;hij&quot; status=&quot;vol&quot; vwtype=&quot;pers&quot; wh=&quot;nwh&quot; word=&quot;hij&quot;/&gt;</span>
<span class="s1">    &lt;node begin=&quot;5&quot; cat=&quot;smain&quot; end=&quot;8&quot; id=&quot;6&quot; rel=&quot;--&quot;&gt;</span>
<span class="s1">      &lt;node begin=&quot;5&quot; case=&quot;nom&quot; def=&quot;def&quot; end=&quot;6&quot; frame=&quot;pronoun(nwh,thi,sg,de,nom,def)&quot; gen=&quot;de&quot; genus=&quot;masc&quot; getal=&quot;ev&quot; his=&quot;normal&quot; his_1=&quot;normal&quot; id=&quot;7&quot; lcat=&quot;np&quot; lemma=&quot;hij&quot; naamval=&quot;nomin&quot; num=&quot;sg&quot; pdtype=&quot;pron&quot; per=&quot;thi&quot; persoon=&quot;3&quot; pos=&quot;pron&quot; postag=&quot;VNW(pers,pron,nomin,vol,3,ev,masc)&quot; pt=&quot;vnw&quot; rel=&quot;su&quot; rnum=&quot;sg&quot; root=&quot;hij&quot; sense=&quot;hij&quot; status=&quot;vol&quot; vwtype=&quot;pers&quot; wh=&quot;nwh&quot; word=&quot;hij&quot;/&gt;</span>
<span class="s1">      &lt;node begin=&quot;6&quot; end=&quot;7&quot; frame=&quot;verb(unacc,sg_heeft,intransitive)&quot; his=&quot;normal&quot; his_1=&quot;normal&quot; id=&quot;8&quot; infl=&quot;sg_heeft&quot; lcat=&quot;smain&quot; lemma=&quot;zijn&quot; pos=&quot;verb&quot; postag=&quot;WW(pv,tgw,ev)&quot; pt=&quot;ww&quot; pvagr=&quot;ev&quot; pvtijd=&quot;tgw&quot; rel=&quot;hd&quot; root=&quot;ben&quot; sc=&quot;intransitive&quot; sense=&quot;ben&quot; stype=&quot;declarative&quot; tense=&quot;present&quot; word=&quot;is&quot; wvorm=&quot;pv&quot;/&gt;</span>
<span class="s1">      &lt;node begin=&quot;7&quot; end=&quot;8&quot; frame=&quot;adverb&quot; his=&quot;normal&quot; his_1=&quot;normal&quot; id=&quot;9&quot; lcat=&quot;advp&quot; lemma=&quot;nogal&quot; pos=&quot;adv&quot; postag=&quot;BW()&quot; pt=&quot;bw&quot; rel=&quot;mod&quot; root=&quot;nogal&quot; sense=&quot;nogal&quot; word=&quot;nogal&quot;/&gt;</span>
<span class="s1">    &lt;/node&gt;</span>
<span class="s1">  &lt;/node&gt;</span>
<span class="s1">  &lt;sentence sentid=&quot;32&quot;&gt;en uhm en uhm hij hij is nogal&lt;/sentence&gt;</span>
<span class="s1">&lt;metadata&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;charencoding&quot; value=&quot;UTF8&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;childage&quot; value=&quot;&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;childmonths&quot; value=&quot;&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;comment&quot; value=&quot;##META text samplenaam = ASTA-06&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;session&quot; value=&quot;ASTA_sample_06&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;origutt&quot; value=&quot;en uhm en uhm hij hij is nogal &quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;parsefile&quot; value=&quot;Unknown_corpus_ASTA_sample_06_u00000000046.xml&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;speaker&quot; value=&quot;PMA&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;int&quot; name=&quot;uttendlineno&quot; value=&quot;85&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;int&quot; name=&quot;uttid&quot; value=&quot;32&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;int&quot; name=&quot;uttstartlineno&quot; value=&quot;85&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;name&quot; value=&quot;pma&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;SES&quot; value=&quot;&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;age&quot; value=&quot;&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;custom&quot; value=&quot;&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;education&quot; value=&quot;&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;group&quot; value=&quot;&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;language&quot; value=&quot;nld&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;months&quot; value=&quot;&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;role&quot; value=&quot;Other&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;sex&quot; value=&quot;&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;xsid&quot; value=&quot;32&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;int&quot; name=&quot;uttno&quot; value=&quot;46&quot; /&gt;</span>
<span class="s1">&lt;/metadata&gt;</span>
<span class="s1">&lt;/alpino_ds&gt;</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">streestrings</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;alpino_ds version=&quot;1.6&quot;&gt;</span>
<span class="s1">  &lt;parser cats=&quot;3&quot; skips=&quot;0&quot; /&gt;</span>
<span class="s1">  &lt;node begin=&quot;0&quot; cat=&quot;top&quot; end=&quot;17&quot; id=&quot;0&quot; rel=&quot;top&quot;&gt;</span>
<span class="s1">    &lt;node begin=&quot;0&quot; cat=&quot;du&quot; end=&quot;16&quot; id=&quot;1&quot; rel=&quot;--&quot;&gt;</span>
<span class="s1">      &lt;node begin=&quot;0&quot; cat=&quot;smain&quot; end=&quot;3&quot; id=&quot;2&quot; rel=&quot;dp&quot;&gt;</span>
<span class="s1">        &lt;node begin=&quot;0&quot; case=&quot;nom&quot; def=&quot;def&quot; end=&quot;1&quot; frame=&quot;pronoun(nwh,fir,sg,de,nom,def)&quot; gen=&quot;de&quot; getal=&quot;ev&quot; his=&quot;normal&quot; his_1=&quot;normal&quot; id=&quot;3&quot; lcat=&quot;np&quot; lemma=&quot;ik&quot; naamval=&quot;nomin&quot; num=&quot;sg&quot; pdtype=&quot;pron&quot; per=&quot;fir&quot; persoon=&quot;1&quot; pos=&quot;pron&quot; postag=&quot;VNW(pers,pron,nomin,vol,1,ev)&quot; pt=&quot;vnw&quot; rel=&quot;su&quot; rnum=&quot;sg&quot; root=&quot;ik&quot; sense=&quot;ik&quot; status=&quot;vol&quot; vwtype=&quot;pers&quot; wh=&quot;nwh&quot; word=&quot;ik&quot;/&gt;</span>
<span class="s1">        &lt;node begin=&quot;1&quot; end=&quot;2&quot; frame=&quot;verb(hebben,sg1,transitive_ndev)&quot; his=&quot;normal&quot; his_1=&quot;normal&quot; id=&quot;4&quot; infl=&quot;sg1&quot; lcat=&quot;smain&quot; lemma=&quot;hebben&quot; pos=&quot;verb&quot; postag=&quot;WW(pv,tgw,ev)&quot; pt=&quot;ww&quot; pvagr=&quot;ev&quot; pvtijd=&quot;tgw&quot; rel=&quot;hd&quot; root=&quot;heb&quot; sc=&quot;transitive_ndev&quot; sense=&quot;heb&quot; stype=&quot;declarative&quot; tense=&quot;present&quot; word=&quot;heb&quot; wvorm=&quot;pv&quot;/&gt;</span>
<span class="s1">        &lt;node begin=&quot;2&quot; case=&quot;both&quot; def=&quot;indef&quot; end=&quot;3&quot; frame=&quot;pronoun(nwh,thi,sg,both,both,indef,strpro)&quot; gen=&quot;both&quot; his=&quot;normal&quot; his_1=&quot;normal&quot; id=&quot;5&quot; lcat=&quot;np&quot; lemma=&quot;één&quot; num=&quot;sg&quot; numtype=&quot;hoofd&quot; per=&quot;thi&quot; pos=&quot;pron&quot; positie=&quot;vrij&quot; postag=&quot;TW(hoofd,vrij)&quot; pt=&quot;tw&quot; rel=&quot;obj1&quot; rnum=&quot;sg&quot; root=&quot;één&quot; sense=&quot;één&quot; special=&quot;strpro&quot; wh=&quot;nwh&quot; word=&quot;een&quot;/&gt;</span>
<span class="s1">      &lt;/node&gt;</span>
<span class="s1">      &lt;node begin=&quot;3&quot; cat=&quot;smain&quot; end=&quot;6&quot; id=&quot;6&quot; rel=&quot;dp&quot;&gt;</span>
<span class="s1">        &lt;node begin=&quot;3&quot; case=&quot;nom&quot; def=&quot;def&quot; end=&quot;4&quot; frame=&quot;pronoun(nwh,fir,sg,de,nom,def)&quot; gen=&quot;de&quot; getal=&quot;ev&quot; his=&quot;normal&quot; his_1=&quot;normal&quot; id=&quot;7&quot; lcat=&quot;np&quot; lemma=&quot;ik&quot; naamval=&quot;nomin&quot; num=&quot;sg&quot; pdtype=&quot;pron&quot; per=&quot;fir&quot; persoon=&quot;1&quot; pos=&quot;pron&quot; postag=&quot;VNW(pers,pron,nomin,vol,1,ev)&quot; pt=&quot;vnw&quot; rel=&quot;su&quot; rnum=&quot;sg&quot; root=&quot;ik&quot; sense=&quot;ik&quot; status=&quot;vol&quot; vwtype=&quot;pers&quot; wh=&quot;nwh&quot; word=&quot;ik&quot;/&gt;</span>
<span class="s1">        &lt;node begin=&quot;4&quot; end=&quot;5&quot; frame=&quot;verb(hebben,sg1,transitive_ndev)&quot; his=&quot;normal&quot; his_1=&quot;normal&quot; id=&quot;8&quot; infl=&quot;sg1&quot; lcat=&quot;smain&quot; lemma=&quot;hebben&quot; pos=&quot;verb&quot; postag=&quot;WW(pv,tgw,ev)&quot; pt=&quot;ww&quot; pvagr=&quot;ev&quot; pvtijd=&quot;tgw&quot; rel=&quot;hd&quot; root=&quot;heb&quot; sc=&quot;transitive_ndev&quot; sense=&quot;heb&quot; stype=&quot;declarative&quot; tense=&quot;present&quot; word=&quot;heb&quot; wvorm=&quot;pv&quot;/&gt;</span>
<span class="s1">        &lt;node begin=&quot;5&quot; case=&quot;both&quot; def=&quot;indef&quot; end=&quot;6&quot; frame=&quot;pronoun(nwh,thi,sg,both,both,indef,strpro)&quot; gen=&quot;both&quot; his=&quot;normal&quot; his_1=&quot;normal&quot; id=&quot;9&quot; lcat=&quot;np&quot; lemma=&quot;één&quot; num=&quot;sg&quot; numtype=&quot;hoofd&quot; per=&quot;thi&quot; pos=&quot;pron&quot; positie=&quot;vrij&quot; postag=&quot;TW(hoofd,vrij)&quot; pt=&quot;tw&quot; rel=&quot;obj1&quot; rnum=&quot;sg&quot; root=&quot;één&quot; sense=&quot;één&quot; special=&quot;strpro&quot; wh=&quot;nwh&quot; word=&quot;een&quot;/&gt;</span>
<span class="s1">      &lt;/node&gt;</span>
<span class="s1">      &lt;node begin=&quot;6&quot; cat=&quot;smain&quot; end=&quot;16&quot; id=&quot;10&quot; rel=&quot;dp&quot;&gt;</span>
<span class="s1">        &lt;node begin=&quot;6&quot; case=&quot;nom&quot; def=&quot;def&quot; end=&quot;7&quot; frame=&quot;pronoun(nwh,fir,sg,de,nom,def)&quot; gen=&quot;de&quot; getal=&quot;ev&quot; his=&quot;normal&quot; his_1=&quot;normal&quot; id=&quot;11&quot; lcat=&quot;np&quot; lemma=&quot;ik&quot; naamval=&quot;nomin&quot; num=&quot;sg&quot; pdtype=&quot;pron&quot; per=&quot;fir&quot; persoon=&quot;1&quot; pos=&quot;pron&quot; postag=&quot;VNW(pers,pron,nomin,vol,1,ev)&quot; pt=&quot;vnw&quot; rel=&quot;su&quot; rnum=&quot;sg&quot; root=&quot;ik&quot; sense=&quot;ik&quot; status=&quot;vol&quot; vwtype=&quot;pers&quot; wh=&quot;nwh&quot; word=&quot;ik&quot;/&gt;</span>
<span class="s1">        &lt;node begin=&quot;7&quot; end=&quot;8&quot; frame=&quot;verb(hebben,sg1,transitive_ndev)&quot; his=&quot;normal&quot; his_1=&quot;normal&quot; id=&quot;12&quot; infl=&quot;sg1&quot; lcat=&quot;smain&quot; lemma=&quot;hebben&quot; pos=&quot;verb&quot; postag=&quot;WW(pv,tgw,ev)&quot; pt=&quot;ww&quot; pvagr=&quot;ev&quot; pvtijd=&quot;tgw&quot; rel=&quot;hd&quot; root=&quot;heb&quot; sc=&quot;transitive_ndev&quot; sense=&quot;heb&quot; stype=&quot;declarative&quot; tense=&quot;present&quot; word=&quot;heb&quot; wvorm=&quot;pv&quot;/&gt;</span>
<span class="s1">        &lt;node begin=&quot;8&quot; cat=&quot;np&quot; end=&quot;16&quot; id=&quot;13&quot; rel=&quot;obj1&quot;&gt;</span>
<span class="s1">          &lt;node begin=&quot;8&quot; end=&quot;9&quot; frame=&quot;determiner(een)&quot; his=&quot;normal&quot; his_1=&quot;normal&quot; id=&quot;14&quot; infl=&quot;een&quot; lcat=&quot;detp&quot; lemma=&quot;een&quot; lwtype=&quot;onbep&quot; naamval=&quot;stan&quot; npagr=&quot;agr&quot; pos=&quot;det&quot; postag=&quot;LID(onbep,stan,agr)&quot; pt=&quot;lid&quot; rel=&quot;det&quot; root=&quot;een&quot; sense=&quot;een&quot; word=&quot;een&quot;/&gt;</span>
<span class="s1">          &lt;node begin=&quot;9&quot; end=&quot;10&quot; frame=&quot;noun(de,count,bare_meas)&quot; gen=&quot;de&quot; genus=&quot;zijd&quot; getal=&quot;ev&quot; graad=&quot;basis&quot; his=&quot;normal&quot; his_1=&quot;normal&quot; id=&quot;15&quot; lcat=&quot;np&quot; lemma=&quot;man&quot; naamval=&quot;stan&quot; ntype=&quot;soort&quot; num=&quot;bare_meas&quot; pos=&quot;noun&quot; postag=&quot;N(soort,ev,basis,zijd,stan)&quot; pt=&quot;n&quot; rel=&quot;hd&quot; rnum=&quot;sg&quot; root=&quot;man&quot; sense=&quot;man&quot; word=&quot;man&quot;/&gt;</span>
<span class="s1">          &lt;node begin=&quot;10&quot; cat=&quot;rel&quot; end=&quot;16&quot; id=&quot;16&quot; rel=&quot;mod&quot;&gt;</span>
<span class="s1">            &lt;node begin=&quot;10&quot; cat=&quot;pp&quot; end=&quot;12&quot; id=&quot;17&quot; index=&quot;1&quot; rel=&quot;rhd&quot;&gt;</span>
<span class="s1">              &lt;node begin=&quot;10&quot; end=&quot;11&quot; frame=&quot;preposition(met,[mee,[en,al]])&quot; his=&quot;normal&quot; his_1=&quot;normal&quot; id=&quot;18&quot; lcat=&quot;pp&quot; lemma=&quot;met&quot; pos=&quot;prep&quot; postag=&quot;VZ(init)&quot; pt=&quot;vz&quot; rel=&quot;hd&quot; root=&quot;met&quot; sense=&quot;met&quot; vztype=&quot;init&quot; word=&quot;met&quot;/&gt;</span>
<span class="s1">              &lt;node begin=&quot;11&quot; case=&quot;obl&quot; end=&quot;12&quot; frame=&quot;rel_pronoun(both,obl)&quot; gen=&quot;both&quot; getal=&quot;getal&quot; his=&quot;normal&quot; his_1=&quot;normal&quot; id=&quot;19&quot; lcat=&quot;np&quot; lemma=&quot;wie&quot; naamval=&quot;stan&quot; pdtype=&quot;pron&quot; persoon=&quot;3p&quot; pos=&quot;pron&quot; postag=&quot;VNW(vb,pron,stan,vol,3p,getal)&quot; pt=&quot;vnw&quot; rel=&quot;obj1&quot; rnum=&quot;sg&quot; root=&quot;wie&quot; sense=&quot;wie&quot; status=&quot;vol&quot; vwtype=&quot;vb&quot; wh=&quot;rel&quot; word=&quot;wie&quot;/&gt;</span>
<span class="s1">            &lt;/node&gt;</span>
<span class="s1">            &lt;node begin=&quot;10&quot; cat=&quot;ssub&quot; end=&quot;16&quot; id=&quot;20&quot; rel=&quot;body&quot;&gt;</span>
<span class="s1">              &lt;node begin=&quot;12&quot; case=&quot;nom&quot; def=&quot;def&quot; end=&quot;13&quot; frame=&quot;pronoun(nwh,fir,sg,de,nom,def)&quot; gen=&quot;de&quot; getal=&quot;ev&quot; his=&quot;normal&quot; his_1=&quot;normal&quot; id=&quot;21&quot; index=&quot;2&quot; lcat=&quot;np&quot; lemma=&quot;ik&quot; naamval=&quot;nomin&quot; num=&quot;sg&quot; pdtype=&quot;pron&quot; per=&quot;fir&quot; persoon=&quot;1&quot; pos=&quot;pron&quot; postag=&quot;VNW(pers,pron,nomin,vol,1,ev)&quot; pt=&quot;vnw&quot; rel=&quot;su&quot; rnum=&quot;sg&quot; root=&quot;ik&quot; sense=&quot;ik&quot; status=&quot;vol&quot; vwtype=&quot;pers&quot; wh=&quot;nwh&quot; word=&quot;ik&quot;/&gt;</span>
<span class="s1">              &lt;node begin=&quot;13&quot; end=&quot;14&quot; frame=&quot;verb(hebben,modal_not_u,modifier(aux(inf)))&quot; his=&quot;normal&quot; his_1=&quot;normal&quot; id=&quot;22&quot; infl=&quot;modal_not_u&quot; lcat=&quot;ssub&quot; lemma=&quot;willen&quot; pos=&quot;verb&quot; postag=&quot;WW(pv,tgw,ev)&quot; pt=&quot;ww&quot; pvagr=&quot;ev&quot; pvtijd=&quot;tgw&quot; rel=&quot;hd&quot; root=&quot;wil&quot; sc=&quot;modifier(aux(inf))&quot; sense=&quot;wil&quot; tense=&quot;present&quot; word=&quot;wil&quot; wvorm=&quot;pv&quot;/&gt;</span>
<span class="s1">              &lt;node begin=&quot;10&quot; cat=&quot;inf&quot; end=&quot;16&quot; id=&quot;23&quot; rel=&quot;vc&quot;&gt;</span>
<span class="s1">                &lt;node begin=&quot;12&quot; end=&quot;13&quot; id=&quot;24&quot; index=&quot;2&quot; rel=&quot;su&quot;/&gt;</span>
<span class="s1">                &lt;node begin=&quot;14&quot; buiging=&quot;zonder&quot; end=&quot;15&quot; frame=&quot;verb(zijn,inf(no_e),aux(inf))&quot; his=&quot;normal&quot; his_1=&quot;normal&quot; id=&quot;25&quot; infl=&quot;inf(no_e)&quot; lcat=&quot;inf&quot; lemma=&quot;gaan&quot; pos=&quot;verb&quot; positie=&quot;vrij&quot; postag=&quot;WW(inf,vrij,zonder)&quot; pt=&quot;ww&quot; rel=&quot;hd&quot; root=&quot;ga&quot; sc=&quot;aux(inf)&quot; sense=&quot;ga&quot; word=&quot;gaan&quot; wvorm=&quot;inf&quot;/&gt;</span>
<span class="s1">                &lt;node begin=&quot;10&quot; cat=&quot;inf&quot; end=&quot;16&quot; id=&quot;26&quot; rel=&quot;vc&quot;&gt;</span>
<span class="s1">                  &lt;node begin=&quot;10&quot; end=&quot;12&quot; id=&quot;27&quot; index=&quot;1&quot; rel=&quot;pc&quot;/&gt;</span>
<span class="s1">                  &lt;node begin=&quot;12&quot; end=&quot;13&quot; id=&quot;28&quot; index=&quot;2&quot; rel=&quot;su&quot;/&gt;</span>
<span class="s1">                  &lt;node begin=&quot;15&quot; buiging=&quot;zonder&quot; end=&quot;16&quot; frame=&quot;verb(zijn,inf,pc_pp(met))&quot; his=&quot;normal&quot; his_1=&quot;normal&quot; id=&quot;29&quot; infl=&quot;inf&quot; lcat=&quot;inf&quot; lemma=&quot;trouwen&quot; pos=&quot;verb&quot; positie=&quot;vrij&quot; postag=&quot;WW(inf,vrij,zonder)&quot; pt=&quot;ww&quot; rel=&quot;hd&quot; root=&quot;trouw&quot; sc=&quot;pc_pp(met)&quot; sense=&quot;trouw-met&quot; word=&quot;trouwen&quot; wvorm=&quot;inf&quot;/&gt;</span>
<span class="s1">                &lt;/node&gt;</span>
<span class="s1">              &lt;/node&gt;</span>
<span class="s1">            &lt;/node&gt;</span>
<span class="s1">          &lt;/node&gt;</span>
<span class="s1">        &lt;/node&gt;</span>
<span class="s1">      &lt;/node&gt;</span>
<span class="s1">    &lt;/node&gt;</span>
<span class="s1">    &lt;node begin=&quot;16&quot; end=&quot;17&quot; frame=&quot;--&quot; genus=&quot;zijd&quot; getal=&quot;ev&quot; graad=&quot;basis&quot; his=&quot;skip&quot; id=&quot;30&quot; lcat=&quot;--&quot; lemma=&quot;uhm&quot; naamval=&quot;stan&quot; ntype=&quot;soort&quot; pos=&quot;--&quot; postag=&quot;N(soort,ev,basis,zijd,stan)&quot; pt=&quot;n&quot; rel=&quot;--&quot; root=&quot;uhm&quot; sense=&quot;uhm&quot; word=&quot;uhm&quot;/&gt;</span>
<span class="s1">  &lt;/node&gt;</span>
<span class="s1">  &lt;sentence sentid=&quot;29&quot;&gt;ik heb een ik heb een ik heb een man met wie ik wil gaan trouwen uhm&lt;/sentence&gt;</span>
<span class="s1">&lt;metadata&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;charencoding&quot; value=&quot;UTF8&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;childage&quot; value=&quot;&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;childmonths&quot; value=&quot;&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;comment&quot; value=&quot;##META text samplenaam = ASTA-06&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;session&quot; value=&quot;ASTA_sample_06&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;origutt&quot; value=&quot;ik heb een ik heb een ik heb een man met wie ik wil gaan trouwen uhm &quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;parsefile&quot; value=&quot;Unknown_corpus_ASTA_sample_06_u00000000042.xml&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;speaker&quot; value=&quot;PMA&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;int&quot; name=&quot;uttendlineno&quot; value=&quot;78&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;int&quot; name=&quot;uttid&quot; value=&quot;29&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;int&quot; name=&quot;uttstartlineno&quot; value=&quot;78&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;name&quot; value=&quot;pma&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;SES&quot; value=&quot;&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;age&quot; value=&quot;&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;custom&quot; value=&quot;&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;education&quot; value=&quot;&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;group&quot; value=&quot;&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;language&quot; value=&quot;nld&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;months&quot; value=&quot;&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;role&quot; value=&quot;Other&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;sex&quot; value=&quot;&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;text&quot; name=&quot;xsid&quot; value=&quot;29&quot; /&gt;</span>
<span class="s1">&lt;meta type=&quot;int&quot; name=&quot;uttno&quot; value=&quot;42&quot; /&gt;</span>
<span class="s1">&lt;/metadata&gt;</span>
<span class="s1">&lt;/alpino_ds&gt;</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">strees</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">streestrings</span><span class="p">:</span>
    <span class="n">strees</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">streestrings</span><span class="p">[</span><span class="n">el</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">test</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">strees</span><span class="p">:</span>
        <span class="n">stree</span> <span class="o">=</span> <span class="n">strees</span><span class="p">[</span><span class="n">el</span><span class="p">]</span>
        <span class="n">lmc</span> <span class="o">=</span> <span class="n">lastmainclauseof</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">getmarkedutt</span><span class="p">(</span><span class="n">lmc</span><span class="p">,</span> <span class="n">stree</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">getsentid</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UttId</span><span class="p">:</span>
    <span class="n">sentidlist</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">sentidxpath</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sentidlist</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Missing sentid&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sentidlist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">testindextransform</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">strees</span><span class="p">:</span>
        <span class="n">stree</span> <span class="o">=</span> <span class="n">strees</span><span class="p">[</span><span class="n">el</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
        <span class="n">simpleshow</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
        <span class="n">newstree</span> <span class="o">=</span> <span class="n">indextransform</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
        <span class="n">simpleshow</span><span class="p">(</span><span class="n">newstree</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">adaptsentence</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="c1"># adapt the sentence</span>
    <span class="c1"># find the sentence element&#39;s parent and its index</span>
    <span class="n">sentid</span> <span class="o">=</span> <span class="n">getsentid</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
    <span class="n">sentencenode</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.//sentence&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sentencenode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">ERROR</span><span class="p">(</span><span class="s1">&#39;No sentence element found for stree with sentid=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sentid</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">stree</span>
    <span class="n">sentencenodeparent</span> <span class="o">=</span> <span class="n">sentencenode</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
    <span class="n">sentencenodeindex</span> <span class="o">=</span> <span class="n">sentencenodeparent</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sentencenode</span><span class="p">)</span>
    <span class="n">sentencenodeparent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">sentencenode</span><span class="p">)</span>
    <span class="c1"># del sentencenodeparent[sentencenodeindex]</span>
    <span class="n">theyield</span> <span class="o">=</span> <span class="n">getyield</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
    <span class="n">theyieldstr</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">theyield</span><span class="p">)</span>
    <span class="n">newsentence</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;sentence&#39;</span><span class="p">)</span>
    <span class="n">newsentence</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">theyieldstr</span>
    <span class="n">newsentence</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;sentid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sentid</span>
    <span class="n">sentencenodeparent</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">sentencenodeindex</span><span class="p">,</span> <span class="n">newsentence</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">stree</span>


<span class="k">def</span> <span class="nf">transplant_node</span><span class="p">(</span><span class="n">node1</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">node2</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    replace node1 by node2 in stree</span>
<span class="sd">    Only do so if node1 and node2 have no children and if their spans are identical</span>
<span class="sd">    :param node1: node to be replaced in stree</span>
<span class="sd">    :param node2: node to replace node1 in stree</span>
<span class="sd">    :param stree: tree in which the replacement takes place</span>
<span class="sd">    :return: the stree in which the input parameter is modified</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># find the parent of node1</span>
    <span class="c1"># determine the index of node1</span>
    <span class="n">sentid</span> <span class="o">=</span> <span class="n">getsentid</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
    <span class="n">parentindex</span> <span class="o">=</span> <span class="n">get_parentandindex</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">stree</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parentindex</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">stree</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">parent</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">parentindex</span>
        <span class="c1"># SDLOGGER.debug(simpleshow(parent))</span>
        <span class="k">del</span> <span class="n">parent</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="c1"># SDLOGGER.debug(simpleshow(parent))</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
        <span class="c1"># SDLOGGER.debug(simpleshow(parent))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">stree</span>
        <span class="c1"># SDLOGGER.debug(simpleshow(stree))</span>

    <span class="c1"># adapt the sentence</span>
    <span class="c1"># find the sentence element&#39;s parent and its index</span>
    <span class="n">sentencenode</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.//sentence&#39;</span><span class="p">)</span>
    <span class="n">sentencenodeparent</span> <span class="o">=</span> <span class="n">sentencenode</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
    <span class="n">sentencenodeindex</span> <span class="o">=</span> <span class="n">sentencenodeparent</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sentencenode</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">sentencenodeparent</span><span class="p">[</span><span class="n">sentencenodeindex</span><span class="p">]</span>
    <span class="n">theyield</span> <span class="o">=</span> <span class="n">getyield</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
    <span class="n">theyieldstr</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">theyield</span><span class="p">)</span>
    <span class="n">newsentence</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;sentence&#39;</span><span class="p">)</span>
    <span class="n">newsentence</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">theyieldstr</span>
    <span class="n">newsentence</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;sentid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sentid</span>
    <span class="n">sentencenodeparent</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">sentencenodeindex</span><span class="p">,</span> <span class="n">newsentence</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">stree</span>


<span class="k">def</span> <span class="nf">get_parentandindex</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">SynTree</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    :param node: node to find the parent of</span>
<span class="sd">    :param stree: stree to find the parent of node in</span>
<span class="sd">    :return: (parentnode::node, index::int) or None</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">nodespan</span> <span class="o">=</span> <span class="n">getspan</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">stree</span><span class="p">:</span>
        <span class="n">childspan</span> <span class="o">=</span> <span class="n">getspan</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">childspan</span> <span class="o">==</span> <span class="n">nodespan</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">chresult</span> <span class="o">=</span> <span class="n">get_parentandindex</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">chresult</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">chresult</span>
        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">getspan</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Span</span><span class="p">:</span>
    <span class="n">nodebegin</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;begin&#39;</span><span class="p">)</span>
    <span class="n">nodeend</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
    <span class="n">nodespan</span> <span class="o">=</span> <span class="p">(</span><span class="n">nodebegin</span><span class="p">,</span> <span class="n">nodeend</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nodespan</span>


<span class="k">def</span> <span class="nf">lbrother</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="n">nodebegin</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;begin&#39;</span><span class="p">)</span>
    <span class="n">condition</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">getattval</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">nodebegin</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">findfirstnode</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">rbrother</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="n">nodeend</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
    <span class="n">condition</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">getattval</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s1">&#39;begin&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">nodeend</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">findfirstnode</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">findfirstnode</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">SynTree</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">condition</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tree</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">findfirstnode</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">nominal</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;pt&#39;</span><span class="p">)</span>
    <span class="n">cat</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cat</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cat</span> <span class="o">==</span> <span class="s1">&#39;np&#39;</span>
    <span class="k">elif</span> <span class="n">pt</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">pt</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;vnw&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">decomposetree</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">SynTree</span><span class="p">,</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">SynTree</span><span class="p">]:</span>
    <span class="n">metadata</span><span class="p">,</span> <span class="n">sentence</span><span class="p">,</span> <span class="n">comments</span><span class="p">,</span> <span class="n">nod</span><span class="p">,</span> <span class="n">parser</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;metadata&#39;</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">child</span>
        <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;sentence&#39;</span><span class="p">:</span>
            <span class="n">sentence</span> <span class="o">=</span> <span class="n">child</span>
        <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;comments&#39;</span><span class="p">:</span>
            <span class="n">comments</span> <span class="o">=</span> <span class="n">child</span>
        <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">child</span>
        <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;parser&#39;</span><span class="p">:</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">child</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Unknown tag encountered in tree: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">parser</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">sentence</span><span class="p">,</span> <span class="n">comments</span>


<span class="n">comma</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span>


<span class="k">def</span> <span class="nf">str2list</span><span class="p">(</span><span class="n">liststr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">comma</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">bareliststr</span> <span class="o">=</span> <span class="n">liststr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">rawlist</span> <span class="o">=</span> <span class="n">bareliststr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
    <span class="n">cleanlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rawlist</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">cleanlist</span>


<span class="k">def</span> <span class="nf">strliststr2list</span><span class="p">(</span><span class="n">liststr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">comma</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">bareliststr</span> <span class="o">=</span> <span class="n">liststr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">rawlist</span> <span class="o">=</span> <span class="n">bareliststr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
    <span class="n">cleanlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rawlist</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">cleanlist</span>


<span class="k">def</span> <span class="nf">find1</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">xpathquery</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">xpathquery</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">results</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">getxmetatreepositions</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">xmetaname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">poslistname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;annotationposlist&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PositionStr</span><span class="p">]:</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;.//xmeta[@name=&#39;</span><span class="si">{}</span><span class="s2">&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xmetaname</span><span class="p">)</span>
    <span class="n">xmeta</span> <span class="o">=</span> <span class="n">find1</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xmeta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">annposstr</span> <span class="o">=</span> <span class="n">xmeta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">poslistname</span><span class="p">)</span>
    <span class="n">annposlist</span> <span class="o">=</span> <span class="n">str2list</span><span class="p">(</span><span class="n">annposstr</span><span class="p">)</span>
    <span class="n">cleantok</span> <span class="o">=</span> <span class="n">find1</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s1">&#39;.//xmeta[@name=&quot;cleanedtokenpositions&quot;]&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cleantok</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">tokliststr</span> <span class="o">=</span> <span class="n">cleantok</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
    <span class="n">toklist</span> <span class="o">=</span> <span class="n">str2list</span><span class="p">(</span><span class="n">tokliststr</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">toklist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">annposlist</span> <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">toklist</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="c1"># topendxpath = &#39;.//node[@cat=&quot;top&quot;]/@end&#39;</span>
<span class="n">wordnodemodel</span> <span class="o">=</span> <span class="s1">&#39;.//node[(@pt or (not(@pt) and not(@cat) and @index)) and @begin=&quot;</span><span class="si">{}</span><span class="s1">&quot;]&#39;</span>


<span class="k">def</span> <span class="nf">gettokposlist</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PositionStr</span><span class="p">]:</span>
    <span class="n">cleantok</span> <span class="o">=</span> <span class="n">find1</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s1">&#39;.//xmeta[@name=&quot;cleanedtokenpositions&quot;]&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cleantok</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">tokliststr</span> <span class="o">=</span> <span class="n">cleantok</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
    <span class="n">toklist</span> <span class="o">=</span> <span class="n">str2list</span><span class="p">(</span><span class="n">tokliststr</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">toklist</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">gettreepos</span><span class="p">(</span><span class="n">origpos</span><span class="p">:</span> <span class="n">PositionStr</span><span class="p">,</span> <span class="n">reverseindex</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PositionStr</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">PositionStr</span><span class="p">:</span>  <span class="c1"># origuttpos2treepos</span>
    <span class="k">if</span> <span class="n">origpos</span> <span class="ow">in</span> <span class="n">reverseindex</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">reverseindex</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">origpos</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;origpos </span><span class="si">{}</span><span class="s1"> not in reverseindex: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">origpos</span><span class="p">,</span> <span class="n">reverseindex</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">deletewordnode</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">begin</span><span class="p">:</span> <span class="n">Position</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="n">newtree</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">newtree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">newtree</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wordnodexpath</span> <span class="o">=</span> <span class="n">wordnodemodel</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">begin</span><span class="p">))</span>
        <span class="n">thenode</span> <span class="o">=</span> <span class="n">find1</span><span class="p">(</span><span class="n">newtree</span><span class="p">,</span> <span class="n">wordnodexpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">thenode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">thenode</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">thenode</span><span class="p">)</span>
        <span class="c1"># renumber begins and ends must be done outside this functions when all deletions have been done;</span>
        <span class="c1"># updatebeginend(newtree, begin)</span>

        <span class="c1"># adapt the cleantokenisation</span>
        <span class="c1"># done outside this function</span>

        <span class="c1"># adapt the sentence: do this after all deletions</span>
        <span class="c1"># newtree = adaptsentence(newtree)</span>

        <span class="k">return</span> <span class="n">newtree</span>


<span class="k">def</span> <span class="nf">showtree</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">deletechildlessparent</span><span class="p">(</span><span class="n">thenode</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    deletes thenode if it has no children, and if its parent is childless after that, applies itself to the parent</span>
<span class="sd">    :param thenode:</span>
<span class="sd">    :return:</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">thenode</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">theparent</span> <span class="o">=</span> <span class="n">thenode</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
        <span class="n">theparent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">thenode</span><span class="p">)</span>
        <span class="n">deletechildlessparent</span><span class="p">(</span><span class="n">theparent</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">olddeletewordnodes</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">begins</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Position</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="c1"># print(&#39;tree:&#39;)</span>
    <span class="c1"># etree.dump(tree, pretty_print=True)</span>
    <span class="n">newtree</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="c1"># print(&#39;newtree:&#39;)</span>
    <span class="c1"># etree.dump(newtree, pretty_print=True)</span>
    <span class="k">if</span> <span class="n">newtree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">newtree</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># wordnodexpath = wordnodemodel.format(str(begin))</span>
        <span class="n">thenodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">begin</span> <span class="ow">in</span> <span class="n">begins</span><span class="p">:</span>
            <span class="n">thenodes</span> <span class="o">+=</span> <span class="n">newtree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">wordnodemodel</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">begin</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">thenode</span> <span class="ow">in</span> <span class="n">thenodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">thenode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">theparent</span> <span class="o">=</span> <span class="n">thenode</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
                <span class="n">theparent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">thenode</span><span class="p">)</span>
                <span class="c1"># if the parent has no sons left, it should be deleted as well</span>
                <span class="n">deletechildlessparent</span><span class="p">(</span><span class="n">theparent</span><span class="p">)</span>
                <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">theparent</span><span class="p">]</span>
                <span class="p">(</span><span class="n">minbegin</span><span class="p">,</span> <span class="n">maxend</span><span class="p">)</span> <span class="o">=</span> <span class="n">getbeginend</span><span class="p">(</span><span class="n">children</span><span class="p">)</span>
                <span class="n">theparent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minbegin</span>
                <span class="n">theparent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxend</span>

        <span class="c1">#</span>
        <span class="c1"># renumber begins and ends ;</span>
        <span class="c1"># normalisebeginend(newtree) temporarily put off</span>

        <span class="c1"># adapt the cleantokenisation</span>
        <span class="c1"># done outside this function</span>

        <span class="c1"># adapt the sentence</span>
        <span class="n">newtree</span> <span class="o">=</span> <span class="n">adaptsentence</span><span class="p">(</span><span class="n">newtree</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">newtree</span>

<span class="c1">##redefine: no children with tag == &#39;node&#39;  (because of UD extensions )</span>
<span class="k">def</span> <span class="nf">childless</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">):</span>
    <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">ch</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">node</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">children</span> <span class="o">==</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">deletewordnodes</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">begins</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Position</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="n">newtree</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="n">newtree</span> <span class="o">=</span> <span class="n">deletewordnodes2</span><span class="p">(</span><span class="n">newtree</span><span class="p">,</span> <span class="n">begins</span><span class="p">)</span>
    <span class="n">newtree</span> <span class="o">=</span> <span class="n">adaptsentence</span><span class="p">(</span><span class="n">newtree</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newtree</span>

<span class="k">def</span> <span class="nf">deletewordnodes2</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">begins</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Position</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tree</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
            <span class="n">newchild</span> <span class="o">=</span> <span class="n">deletewordnodes2</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">begins</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newchild</span> <span class="o">=</span> <span class="n">child</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
            <span class="n">childbegin</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;begin&#39;</span><span class="p">)</span>
            <span class="n">childbeginint</span>  <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">childbegin</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">childbeginint</span> <span class="ow">in</span> <span class="n">begins</span> <span class="ow">and</span> <span class="n">childless</span><span class="p">(</span><span class="n">child</span><span class="p">):</span>
                <span class="n">tree</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;cat&#39;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span> <span class="ow">and</span> <span class="n">childless</span><span class="p">(</span><span class="n">child</span><span class="p">):</span>  <span class="c1"># if its children have been deleted earlier</span>
                <span class="n">tree</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
     <span class="c1"># tree  begin en end bijwerken</span>
    <span class="k">if</span> <span class="n">tree</span><span class="o">.</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
        <span class="n">newchildren</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">newchildren</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="p">(</span><span class="n">minbegin</span><span class="p">,</span> <span class="n">maxend</span><span class="p">)</span> <span class="o">=</span> <span class="n">getbeginend</span><span class="p">(</span><span class="n">newchildren</span><span class="p">)</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minbegin</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxend</span>
    <span class="k">return</span> <span class="n">tree</span>


<span class="k">def</span> <span class="nf">olddeletewordnodes2</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">begins</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Position</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tree</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>
            <span class="n">newchild</span> <span class="o">=</span> <span class="n">deletewordnodes2</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">begins</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
            <span class="n">nodebegin</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s1">&#39;begin&#39;</span><span class="p">)</span>
            <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">child</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">nodebegin</span><span class="p">)</span> <span class="ow">in</span> <span class="n">begins</span><span class="p">:</span>  <span class="c1"># only words and indexnodes can be deleted</span>
                <span class="n">theparent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">theparent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">children</span> <span class="o">==</span> <span class="p">[]:</span>
                        <span class="n">theparent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
                        <span class="c1"># if the parent has no sons left, it should be deleted as well</span>
                        <span class="n">deletechildlessparent</span><span class="p">(</span><span class="n">theparent</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">theparent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
                        <span class="n">newchildren</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">theparent</span><span class="p">]</span>
                        <span class="p">(</span><span class="n">minbegin</span><span class="p">,</span> <span class="n">maxend</span><span class="p">)</span> <span class="o">=</span> <span class="n">getbeginend</span><span class="p">(</span><span class="n">newchildren</span><span class="p">)</span>
                        <span class="n">theparent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minbegin</span>
                        <span class="n">theparent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxend</span>
        <span class="k">return</span> <span class="n">tree</span>


<div class="viewcode-block" id="treeinflate"><a class="viewcode-back" href="../deviantlanguage.html#treebankfunctions.treeinflate">[docs]</a><span class="k">def</span> <span class="nf">treeinflate</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">inc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The function *treeinflate* adapts the input tree *stree* in such a way that:</span>

<span class="sd">    * for word nodes: the int value of the *begin* attribute o (ib) is changed to str(newib =(ib + 1) * inc), and the value of the *end* attribute to str(newib + 1)</span>
<span class="sd">    * for phrasal nodes: new values for *begin* and *end* are computed by the function *getbeginend*</span>
<span class="sd">    * for other nodes: the same as  for word nodes</span>

<span class="sd">    The parameters of this function are:</span>

<span class="sd">    * stree: input syntactic structure, which is modified</span>
<span class="sd">    * start: not used yet and probably not necessary (default value = 10)</span>
<span class="sd">    * inc: increment, by default set to 10 (not used yet)</span>

<span class="sd">    and it returns *None*.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># fatstree = deepcopy(stree)</span>
    <span class="k">if</span> <span class="n">stree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">stree</span><span class="p">:</span>
            <span class="n">treeinflate</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span>
        <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">ch</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">stree</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">stree</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
            <span class="n">ib</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">getattval</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="s1">&#39;begin&#39;</span><span class="p">))</span>
            <span class="n">ie</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">getattval</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">))</span>
            <span class="n">newib</span> <span class="o">=</span> <span class="p">(</span><span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>
            <span class="n">stree</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">newib</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">iswordnode</span><span class="p">(</span><span class="n">stree</span><span class="p">):</span>
                <span class="n">stree</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">newib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;cat&#39;</span> <span class="ow">in</span> <span class="n">stree</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="o">=</span> <span class="n">getbeginend</span><span class="p">(</span><span class="n">children</span><span class="p">)</span>
                <span class="n">stree</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
                <span class="n">stree</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stree</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
                <span class="n">stree</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">ie</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">isidentitymap</span><span class="p">(</span><span class="n">dct</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span><span class="n">key</span> <span class="o">==</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dct</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">updatetokenpos</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">tokenposdict</span><span class="p">:</span> <span class="n">PositionMap</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">stree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">stree</span>
    <span class="k">if</span> <span class="n">isidentitymap</span><span class="p">(</span><span class="n">tokenposdict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">stree</span>
    <span class="n">resulttree</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
    <span class="n">resulttree</span> <span class="o">=</span> <span class="n">updatetokenpos2</span><span class="p">(</span><span class="n">resulttree</span><span class="p">,</span> <span class="n">tokenposdict</span><span class="p">)</span>
    <span class="n">finaltree</span> <span class="o">=</span> <span class="n">updateindexnodes</span><span class="p">(</span><span class="n">resulttree</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">finaltree</span>

<span class="k">def</span> <span class="nf">updatetokenpos2</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">tokenposdict</span><span class="p">:</span> <span class="n">PositionMap</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">node</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
        <span class="n">newchild</span> <span class="o">=</span> <span class="n">updatetokenpos2</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">tokenposdict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;pt&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span> <span class="ow">or</span> <span class="s1">&#39;pos&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="s1">&#39;end&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span> <span class="ow">and</span> <span class="s1">&#39;begin&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
            <span class="n">intend</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">intend</span> <span class="ow">in</span> <span class="n">tokenposdict</span><span class="p">:</span>
                <span class="n">newendint</span> <span class="o">=</span> <span class="n">tokenposdict</span><span class="p">[</span><span class="n">intend</span><span class="p">]</span>
                <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">newendint</span><span class="p">)</span>
                <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">newendint</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Correcttreebank:updatetokenpos: Missing key in tokenposdict: key=</span><span class="si">{key}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">intend</span><span class="p">))</span>
                <span class="n">fulltrees</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;ancestor::node[@cat=&quot;top&quot;]&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fulltrees</span> <span class="o">!=</span> <span class="p">[]:</span>
                    <span class="n">fulltree</span> <span class="o">=</span> <span class="n">fulltrees</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fulltree</span> <span class="o">=</span> <span class="n">node</span>
                <span class="n">sent</span> <span class="o">=</span> <span class="n">getyield</span><span class="p">(</span><span class="n">fulltree</span><span class="p">)</span>
                <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;utterance=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sent</span><span class="p">))</span>
                <span class="c1"># etree.dump(resulttree)</span>
                <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;tokenposdict=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tokenposdict</span><span class="p">))</span>
        <span class="k">elif</span> <span class="s1">&#39;cat&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
            <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">ch</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">node</span><span class="p">]</span>
            <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="o">=</span> <span class="n">getbeginend</span><span class="p">(</span><span class="n">children</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
            <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>
    <span class="k">return</span> <span class="n">node</span>



<span class="k">def</span> <span class="nf">updateindexnodes</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="c1">#presupposes that the non bareindex nodes have been adapted already</span>
    <span class="n">indexednodesmap</span> <span class="o">=</span> <span class="n">getindexednodesmap</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
    <span class="n">newstree</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">newstree</span><span class="o">.</span><span class="n">iter</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bareindexnode</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">)</span>
                <span class="n">newbegin</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">indexednodesmap</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="s1">&#39;begin&#39;</span><span class="p">)</span>
                <span class="n">newend</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">indexednodesmap</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
                <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newbegin</span>
                <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newend</span>
    <span class="k">return</span> <span class="n">newstree</span>

<span class="k">def</span> <span class="nf">treewithtokenpos</span><span class="p">(</span><span class="n">thetree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">tokenlist</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Token</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="n">resulttree</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">thetree</span><span class="p">)</span>
    <span class="n">thetreeleaves</span> <span class="o">=</span> <span class="n">getnodeyield</span><span class="p">(</span><span class="n">thetree</span><span class="p">)</span>
    <span class="n">intbegins</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">getattval</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s1">&#39;begin&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">thetreeleaves</span><span class="p">]</span>
    <span class="n">tokenlistbegins</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">pos</span> <span class="o">+</span> <span class="n">t</span><span class="o">.</span><span class="n">subpos</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tokenlist</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">intbegins</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokenlistbegins</span><span class="p">):</span>
        <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;token mismatch&#39;</span><span class="p">)</span>
        <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;tree yield=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">getyield</span><span class="p">(</span><span class="n">thetree</span><span class="p">)))</span>
        <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;tokenlist=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tokenlist</span><span class="p">))</span>
        <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;intbegins=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intbegins</span><span class="p">))</span>
        <span class="n">SDLOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;tokenlistbegins =</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tokenlistbegins</span><span class="p">))</span>
    <span class="n">pospairs</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">intbegins</span><span class="p">,</span> <span class="n">tokenlistbegins</span><span class="p">)</span>
    <span class="n">thetreetokenposdict</span> <span class="o">=</span> <span class="p">{</span><span class="n">treepos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">tokenpos</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">treepos</span><span class="p">,</span> <span class="n">tokenpos</span> <span class="ow">in</span> <span class="n">pospairs</span><span class="p">}</span>
    <span class="n">resulttree</span> <span class="o">=</span> <span class="n">updatetokenpos</span><span class="p">(</span><span class="n">resulttree</span><span class="p">,</span> <span class="n">thetreetokenposdict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resulttree</span>


<span class="k">def</span> <span class="nf">fatparse</span><span class="p">(</span><span class="n">utterance</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tokenlist</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Token</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="n">stree</span> <span class="o">=</span> <span class="n">PARSE_FUNC</span><span class="p">(</span><span class="n">utterance</span><span class="p">)</span>
    <span class="n">fatstree</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
    <span class="n">treeinflate</span><span class="p">(</span><span class="n">fatstree</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">showtree</span><span class="p">(</span><span class="n">fatstree</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;fatparse: fatstree&#39;</span><span class="p">)</span>
    <span class="n">reducedtokenlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokenlist</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="o">.</span><span class="n">skip</span><span class="p">]</span>
    <span class="n">fatstree</span> <span class="o">=</span> <span class="n">treewithtokenpos</span><span class="p">(</span><span class="n">fatstree</span><span class="p">,</span> <span class="n">reducedtokenlist</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">showtree</span><span class="p">(</span><span class="n">fatstree</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;fatparse: fatstree&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fatstree</span>


<span class="k">def</span> <span class="nf">update_cleantokenisation</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">begin</span><span class="p">:</span> <span class="n">PositionStr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    updates the tokenisation info of the cleaned utterance</span>
<span class="sd">    :param stree: tree, will be modified</span>
<span class="sd">    :param begin: value of the begin attribute of the deleted wordnode</span>
<span class="sd">    :return: None</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">intbegin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">begin</span><span class="p">)</span>
    <span class="n">oldcleanedtokmeta</span> <span class="o">=</span> <span class="n">find1</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="s1">&#39;//xmeta[@name=&quot;cleanedtokenisation&quot;]&#39;</span><span class="p">)</span>
    <span class="n">cleanedtokmeta</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">oldcleanedtokmeta</span><span class="p">)</span>
    <span class="n">oldcleanedtokposmeta</span> <span class="o">=</span> <span class="n">find1</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="s1">&#39;//xmeta[@name=&quot;cleanedtokenpositions&quot;]&#39;</span><span class="p">)</span>
    <span class="n">cleanedtokposmeta</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">oldcleanedtokposmeta</span><span class="p">)</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">oldcleanedtokmeta</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">cleanedtokmeta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cleanedtokposmeta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">cleanedtokstr</span> <span class="o">=</span> <span class="n">cleanedtokmeta</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;annotationwordlist&#39;</span><span class="p">]</span>
        <span class="n">cleanedtok</span> <span class="o">=</span> <span class="n">strliststr2list</span><span class="p">(</span><span class="n">cleanedtokstr</span><span class="p">)</span>
        <span class="n">newcleanedtok</span> <span class="o">=</span> <span class="n">cleanedtok</span><span class="p">[:</span><span class="n">intbegin</span><span class="p">]</span> <span class="o">+</span> <span class="n">cleanedtok</span><span class="p">[</span><span class="n">intbegin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
        <span class="n">newcleanedtokstr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">newcleanedtok</span><span class="p">)</span>
        <span class="n">cleanedtokmeta</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;annotationwordlist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newcleanedtokstr</span>
        <span class="n">cleanedtokmeta</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newcleanedtokstr</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">oldcleanedtokmeta</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cleanedtokmeta</span><span class="p">)</span>

        <span class="n">cleanedtokposstr</span> <span class="o">=</span> <span class="n">cleanedtokposmeta</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;annotationwordlist&#39;</span><span class="p">]</span>
        <span class="n">cleanedtokpos</span> <span class="o">=</span> <span class="n">str2list</span><span class="p">(</span><span class="n">cleanedtokposstr</span><span class="p">)</span>
        <span class="n">newcleanedtokpos</span> <span class="o">=</span> <span class="n">cleanedtokpos</span><span class="p">[:</span><span class="n">intbegin</span><span class="p">]</span> <span class="o">+</span> <span class="n">cleanedtokpos</span><span class="p">[</span><span class="n">intbegin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
        <span class="n">newcleanedtokposintlist</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">istr</span><span class="p">)</span> <span class="k">for</span> <span class="n">istr</span> <span class="ow">in</span> <span class="n">newcleanedtokpos</span><span class="p">]</span>
        <span class="n">newcleanedtokposstr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">newcleanedtokposintlist</span><span class="p">)</span>
        <span class="n">cleanedtokposmeta</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;annotationwordlist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newcleanedtokposstr</span>
        <span class="n">cleanedtokposmeta</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newcleanedtokposstr</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">oldcleanedtokposmeta</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cleanedtokposmeta</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">stree</span>


<span class="k">def</span> <span class="nf">getbeginend</span><span class="p">(</span><span class="n">nodelist</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SynTree</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Span</span><span class="p">:</span>
    <span class="n">minbegin</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">maxend</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bareindexnode</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">nodebegin</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;begin&#39;</span><span class="p">)</span>
        <span class="n">nodeend</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">nodebegin</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">minbegin</span><span class="p">:</span>
            <span class="n">minbegin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nodebegin</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">nodeend</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">maxend</span><span class="p">:</span>
            <span class="n">maxend</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nodeend</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">minbegin</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">maxend</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">normalisebeginend</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    :param stree: syntactic structure</span>
<span class="sd">    :return: stree with the values of begin and end attributes normalised</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># etree.dump(stree, pretty_print=True)</span>
    <span class="c1"># begins = [getattval(node, &#39;begin&#39;) for node in stree.xpath(&#39;.//node[@pt or @pos]&#39;)]  # we must include indexed nodes but not have duplicates</span>
    <span class="n">begins</span> <span class="o">=</span> <span class="p">{</span><span class="n">getattval</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;begin&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">stree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;.//node[count(node)=0]&#39;</span><span class="p">)}</span>
    <span class="n">sortedbegins</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">begins</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">normalisebeginend2</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="n">sortedbegins</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">normalisebeginend2</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">sortedbegins</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PositionStr</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    :param stree: syntactic structure</span>
<span class="sd">    :param sortedbegins: sorted list of begin values of @pt or @pos nodes</span>
<span class="sd">    :return: None</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">children</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
        <span class="n">normalisebeginend2</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">sortedbegins</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stree</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;node&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">children</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">nodebegin</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="s1">&#39;begin&#39;</span><span class="p">)</span>
            <span class="n">intnodebegin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nodebegin</span><span class="p">)</span>
            <span class="n">newintbegin</span> <span class="o">=</span> <span class="n">sortedbegins</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nodebegin</span><span class="p">)</span>
            <span class="n">newbegin</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">newintbegin</span><span class="p">)</span>
            <span class="n">newend</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">newintbegin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">stree</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newbegin</span>
            <span class="n">stree</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newend</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="p">(</span><span class="n">minbegin</span><span class="p">,</span> <span class="n">maxend</span><span class="p">)</span> <span class="o">=</span> <span class="n">getbeginend</span><span class="p">(</span><span class="n">children</span><span class="p">)</span>
            <span class="n">stree</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minbegin</span>
            <span class="n">stree</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxend</span>


<span class="k">def</span> <span class="nf">updatebeginend</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">begin</span><span class="p">:</span> <span class="n">PositionStr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># do not use this anymore</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    updates the begin and end values of nodes in a tree in which a word node with begin=begin has been removed</span>
<span class="sd">    :param stree: Element_tree, input tree, which is modified</span>
<span class="sd">    :param begin: (string representation of an integer): value of the begin attribute of the word node that has been removed</span>
<span class="sd">    :return: None</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">children</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
        <span class="n">updatebeginend</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">begin</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stree</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;node&quot;</span><span class="p">:</span>
        <span class="n">intbegin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">begin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">children</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">nodebegin</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="s1">&#39;begin&#39;</span><span class="p">)</span>
            <span class="n">nodeend</span> <span class="o">=</span> <span class="n">getattval</span><span class="p">(</span><span class="n">stree</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
            <span class="n">intnodebegin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nodebegin</span><span class="p">)</span>
            <span class="n">intnodeend</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nodeend</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">intnodebegin</span> <span class="o">&gt;</span> <span class="n">intbegin</span><span class="p">:</span>
                <span class="n">stree</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">intnodebegin</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">intnodeend</span> <span class="o">&gt;</span> <span class="n">intbegin</span><span class="p">:</span>
                <span class="n">stree</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">intnodeend</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="p">(</span><span class="n">minbegin</span><span class="p">,</span> <span class="n">maxend</span><span class="p">)</span> <span class="o">=</span> <span class="n">getbeginend</span><span class="p">(</span><span class="n">children</span><span class="p">)</span>
            <span class="n">stree</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minbegin</span>
            <span class="n">stree</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxend</span>


<span class="k">def</span> <span class="nf">add_metadata</span><span class="p">(</span><span class="n">intree</span><span class="p">:</span> <span class="n">SynTree</span><span class="p">,</span> <span class="n">metalist</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Meta</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">SynTree</span><span class="p">:</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">intree</span><span class="p">)</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.//metadata&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;metadata&#39;</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">meta</span> <span class="ow">in</span> <span class="n">metalist</span><span class="p">:</span>
        <span class="n">metadata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">toElement</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">tree</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># test()</span>
    <span class="n">testindextransform</span><span class="p">()</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SASTA  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">treebankfunctions</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Jan Odijk, Jelte van Boheemen, Martin Kroon.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.2.
    </div>
  </body>
</html>